<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ashley Lowe Mackenzie et. al">

<title>The economic impact of climate change on coral reef in the Main Hawaiian Islands</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="CoralReef_files/libs/clipboard/clipboard.min.js"></script>
<script src="CoralReef_files/libs/quarto-html/quarto.js"></script>
<script src="CoralReef_files/libs/quarto-html/popper.min.js"></script>
<script src="CoralReef_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="CoralReef_files/libs/quarto-html/anchor.min.js"></script>
<link href="CoralReef_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="CoralReef_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="CoralReef_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="CoralReef_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="CoralReef_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#coral-reef-hawaii" id="toc-coral-reef-hawaii" class="nav-link active" data-scroll-target="#coral-reef-hawaii">Coral Reef Hawaii</a>
  <ul class="collapse">
  <li><a href="#running-code" id="toc-running-code" class="nav-link" data-scroll-target="#running-code">Running Code</a></li>
  <li><a href="#travel-cost" id="toc-travel-cost" class="nav-link" data-scroll-target="#travel-cost">Travel Cost</a></li>
  <li><a href="#atlantis-model" id="toc-atlantis-model" class="nav-link" data-scroll-target="#atlantis-model">Atlantis Model</a>
  <ul class="collapse">
  <li><a href="#base-level-coral" id="toc-base-level-coral" class="nav-link" data-scroll-target="#base-level-coral">Base level Coral</a></li>
  <li><a href="#yearly-percent-change" id="toc-yearly-percent-change" class="nav-link" data-scroll-target="#yearly-percent-change">Yearly Percent Change</a></li>
  </ul></li>
  <li><a href="#prediction-model" id="toc-prediction-model" class="nav-link" data-scroll-target="#prediction-model">Prediction Model</a>
  <ul class="collapse">
  <li><a href="#predict-ssp1" id="toc-predict-ssp1" class="nav-link" data-scroll-target="#predict-ssp1">Predict SSP1</a></li>
  <li><a href="#predict-ssp2" id="toc-predict-ssp2" class="nav-link" data-scroll-target="#predict-ssp2">Predict SSP2</a></li>
  <li><a href="#predict-ssp3" id="toc-predict-ssp3" class="nav-link" data-scroll-target="#predict-ssp3">Predict SSP3</a></li>
  </ul></li>
  <li><a href="#data-aggregation" id="toc-data-aggregation" class="nav-link" data-scroll-target="#data-aggregation">Data Aggregation</a>
  <ul class="collapse">
  <li><a href="#across-island-aggregation" id="toc-across-island-aggregation" class="nav-link" data-scroll-target="#across-island-aggregation">Across Island aggregation</a></li>
  <li><a href="#across-island-aggregation-of-welfare-loss" id="toc-across-island-aggregation-of-welfare-loss" class="nav-link" data-scroll-target="#across-island-aggregation-of-welfare-loss">Across-Island Aggregation of Welfare Loss</a></li>
  <li><a href="#snap-shot-within-island" id="toc-snap-shot-within-island" class="nav-link" data-scroll-target="#snap-shot-within-island">Snap Shot within Island</a></li>
  </ul></li>
  <li><a href="#animation-welfare" id="toc-animation-welfare" class="nav-link" data-scroll-target="#animation-welfare">Animation Welfare</a>
  <ul class="collapse">
  <li><a href="#ssp1" id="toc-ssp1" class="nav-link" data-scroll-target="#ssp1">SSP1</a></li>
  <li><a href="#ssp2" id="toc-ssp2" class="nav-link" data-scroll-target="#ssp2">SSP2</a></li>
  <li><a href="#ssp3" id="toc-ssp3" class="nav-link" data-scroll-target="#ssp3">SSP3</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">The economic impact of climate change on coral reef in the Main Hawaiian Islands</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ashley Lowe Mackenzie et. al </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="coral-reef-hawaii" class="level1">
<h1>Coral Reef Hawaii</h1>
<p>The following code estimates welfare changes associated with varying conditions of nearshore environmental quality on the island of Hawai'i. The primary impact considered is the loss of coral reef biomass, which serves as an environmental and economic asset. Welfare effects are estimated through two distinct models that capture changes in household utility and behavioral responses to environmental degradation. These models use observed visitation and population data to approximate demand, and they translate changes in reef quality into utility impacts, following standard approaches in environmental and recreational economics. The two models include:</p>
<ol type="1">
<li>An Economic Model using a random utility framework from <a href="https://doi.org/10.1016/j.ecolecon.2022.107628">Fezzi. et al 2023</a></li>
<li>Atlantic Biophysical Sub-Model which estimates changes to ecological conditions.</li>
</ol>
<p>The graphical representation of this process is illustrated below</p>
<p><img src="images/Figure2.png" class="img-fluid"></p>
<section id="running-code" class="level2">
<h2 class="anchored" data-anchor-id="running-code">Running Code</h2>
<p>This section calls the necessary R packages and sources external scripts from the original study. These scripts provide the estimated coefficients from the Random Utility Model (RUM), which will be used to simulate individual preferences and estimate welfare changes under different environmental quality scenarios. These parameters reflect the marginal utility of various site attributes, including coral reef biomass, travel cost, and environmental conditions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sf' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">### load functions</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/CR/codedata/dummier.R"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/CR/codedata/travel_cost.R"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/CR/codedata/gridplot.R"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">### load model </span><span class="al">###</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"~/CR/codedata/model3.mod"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="do">### this are the travel cost model estimates </span><span class="al">###</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>m1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$results
                   Estimate Std.Error t-value p-value
cost               -0.07618   0.00168 -45.369  0.0000
home                5.66637   0.12922  43.851  0.0000
coastal            -0.66774   0.19326  -3.455  0.0005
citypark           -0.78030   0.16285  -4.791  0.0000
trailall            0.70325   0.15004   4.687  0.0000
haleakala           4.65179   0.24724  18.815  0.0000
molokini            4.48925   0.53133   8.449  0.0000
parking             1.17803   0.07392  15.936  0.0000
showers             0.59104   0.06156   9.601  0.0000
lifeguard           0.08591   0.06657   1.291  0.1968
rock               -1.26640   0.15266  -8.295  0.0000
manmade            -0.96971   0.18507  -5.240  0.0000
beachmedium         0.11700   0.06968   1.679  0.0931
beachlarge          0.32178   0.07486   4.298  0.0000
surf               -0.28922   0.05674  -5.097  0.0000
swim                0.13087   0.07848   1.668  0.0954
snork               0.27150   0.11923   2.277  0.0228
res_fish_bio        0.03664   0.00357  10.251  0.0000
PNAS                0.00841   0.00741   1.135  0.2565
playground          0.72257   0.06143  11.762  0.0000
sports              0.38978   0.07058   5.523  0.0000
snork:PNAS          0.01968   0.00816   2.412  0.0159
snork:res_fish_bio  0.00598   0.00446   1.342  0.1797

$logLik
[1] -17021.26

$pseudoR2
[1] 0.6505</code></pre>
</div>
</div>
</section>
<section id="travel-cost" class="level2">
<h2 class="anchored" data-anchor-id="travel-cost">Travel Cost</h2>
<p>The following code calculates the <strong>travel cost</strong> from each residential grid to each recreation site across the Hawaiian Islands. It uses economic and geographic data collected from each island, including household income, travel distance, and mode assumptions.</p>
<p>Travel costs are estimated following the methodology of <strong>Fezzi et al.&nbsp;(2023)</strong>, who incorporate both time and monetary expenses into a unified measure of generalized cost. These estimates serve as one of the key explanatory variables in the Random Utility Model (RUM), which is used to simulate recreation site choice.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dist1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/codedata/dist1.csv"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sites_join <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/codedata/sites_join.csv"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">merge</span>(dist1, sites_join)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>coastal[x1<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Home"</span>]<span class="ot">=</span><span class="dv">0</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Prepared dataset for maps plot:</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>siteID),]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> out[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">8</span><span class="sc">:</span><span class="dv">12</span>)]</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="do">##using 85K because that was the survey amount</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>incometran_track<span class="ot">=</span>out<span class="sc">$</span>medincome_tract<span class="sc">/</span><span class="dv">85000</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>coasts <span class="ot">&lt;-</span> sites[sites<span class="sc">$</span>coastal <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> sites<span class="sc">$</span>name<span class="sc">!=</span><span class="st">"Home"</span>,]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="fu">merge</span>(SSP1, x1, <span class="at">by.x =</span> <span class="st">"polygon"</span>, <span class="at">by.y =</span> <span class="st">"Box_ID_2"</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>km2_ID,x1<span class="sc">$</span>siteID),]   <span class="do">## btw it is correct that the dim(x) is lower than dim(dist) because</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="do">## I aggregated some sites</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(x1<span class="sc">$</span>siteID))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="do">### FINISHED LOADING AND MERGING DATASETS </span><span class="al">###</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(dist, pop, sitesjoin)</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE TRAVEL COST ####</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="sc">+</span> <span class="dv">40</span>       <span class="do">## this sites needs 40min walking to be reached</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Need to also do this for Hawaii</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="do">### Change here for different fuel cost</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>distance.meters<span class="sc">*</span><span class="fl">0.001</span> <span class="sc">*</span> (<span class="fl">0.20</span> <span class="sc">/</span> <span class="fl">1.5</span>   )               <span class="do">## fuel cost </span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="do">## assumption on fuel cost:</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 miles/gallon</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># $4.3/gallon</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># means $4.3 per 20 miles --&gt; 0.215 $/mile</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km --&gt; 6.2 miles --&gt; $1.33 travel cost per km</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 10km * 0.20 / 1.5 = $1.33  so the values coincide with the cost used above.</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">+</span> (x1<span class="sc">$</span>duration <span class="sc">/</span> <span class="dv">60</span>)<span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">24.14</span>    <span class="do">## add the value of time (assuming a 25$ per hour average wage rate)</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">*</span> <span class="dv">2</span>                          <span class="do">## the value for a return trip</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="do">#### put Molokini cost equal to the one of Makena Landing Beach Park + 100$ (cost of a snorkeling tour)</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">388</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">359</span>] <span class="sc">+</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="atlantis-model" class="level2">
<h2 class="anchored" data-anchor-id="atlantis-model">Atlantis Model</h2>
<p>To assess environmental changes in the nearshore ecosystem, we incorporate biomass outputs from the Atlantis ecosystem model. These outputs represent projected ecological dynamics—specifically, coral reef and associated species biomass—under different management and environmental scenarios.</p>
<p>The biomass values will be:</p>
<ul>
<li><p>Spatially aggregated by polygon to match the resolution used in the economic model.</p></li>
<li><p>Processed annually to calculate percentage changes in biomass relative to the baseline year.</p></li>
</ul>
<p>These percentage changes provide the key environmental quality metric (e.g., reef health) that feeds into the Economic Model outlined in the previous section. Specifically, the estimated changes will modify site attributes within the Random Utility Model framework to simulate how changes in reef biomass affect recreational behavior and welfare.</p>
<section id="base-level-coral" class="level3">
<h3 class="anchored" data-anchor-id="base-level-coral">Base level Coral</h3>
<p>The base level of coral is the average biomass of 2015-2020 for each near polygon.</p>
<p><img src="images/match_boxs.png" class="img-fluid"></p>
</section>
<section id="yearly-percent-change" class="level3">
<h3 class="anchored" data-anchor-id="yearly-percent-change">Yearly Percent Change</h3>
<p>Then for each time step out to 2100 we sum up the biomass of coral reef:</p>
<p><span class="math inline">\(C_{pt} = \sum V_{pt} / \sum V_{pt}=0\)</span></p>
<p>The following code does this for scenario SSP1 1-3. The file required if from the Atlantis which is to large for github so please request.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">###This grabs Atlantis and gets it into the write steps</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>SSP3_loPPkF <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/codedata/SSP3_control_last.rds"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>biomass_spatial_stanza<span class="ot">=</span>SSP3_loPPkF<span class="sc">$</span>biomass_spatial_stanza</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span><span class="fu">subset</span>(biomass_spatial_stanza,species<span class="sc">==</span><span class="st">"Pocillopora"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites branching"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites massive"</span><span class="sc">|</span>species<span class="sc">==</span><span class="st">"Montipora"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Leptoseris"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="sc">$</span>time<span class="ot">=</span><span class="fu">round</span>(ssp3_coral<span class="sc">$</span>time, <span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(time, polygon, species, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(polygon, time) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Coral_NearShore=</span><span class="fu">sum</span>(atoutput))</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral[ssp3_coral<span class="sc">$</span>polygon <span class="sc">%in%</span> keep, ]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">%%</span> <span class="dv">1</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>ssp3_coral[<span class="fu">order</span>(ssp3_coral<span class="sc">$</span>time),]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">9</span>))</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>t<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">14</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Coral_NearShore))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">13</span>))</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span><span class="fu">merge</span>(t,ssp3_coral)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>percentchangeSSP3<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Coral_perchange =</span> Coral_NearShore<span class="sc">/</span>mean)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>percentchangeSSP3<span class="ot">=</span>percentchangeSSP3[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>percentchangeSSP3<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"time"</span>, percentchangeSSP3<span class="sc">$</span>time )</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>SSP3<span class="ot">=</span><span class="fu">spread</span>(percentchangeSSP3, time, Coral_perchange)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>SSP1_loPPkF <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/codedata/SSP1_control_last.rds"</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>biomass_spatial_stanza<span class="ot">=</span>SSP1_loPPkF<span class="sc">$</span>biomass_spatial_stanza</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span><span class="fu">subset</span>(biomass_spatial_stanza,species<span class="sc">==</span><span class="st">"Pocillopora"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites branching"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites massive"</span><span class="sc">|</span>species<span class="sc">==</span><span class="st">"Montipora"</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Leptoseris"</span>)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(polygon, time) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Coral_NearShore=</span><span class="fu">sum</span>(atoutput))</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral[ssp1_coral<span class="sc">$</span>polygon <span class="sc">%in%</span> keep, ]</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">%%</span> <span class="dv">1</span>))</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>ssp1_coral[<span class="fu">order</span>(ssp1_coral<span class="sc">$</span>time),]</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">9</span>))</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>t<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">14</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Coral_NearShore))</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">13</span>))</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span><span class="fu">merge</span>(t,ssp1_coral)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>percentchangeSSP1<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Coral_perchange =</span> Coral_NearShore<span class="sc">/</span>mean)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>percentchangeSSP1<span class="ot">=</span>percentchangeSSP1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>percentchangeSSP1<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"time"</span>, percentchangeSSP1<span class="sc">$</span>time )</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>SSP1<span class="ot">=</span><span class="fu">spread</span>(percentchangeSSP1, time, Coral_perchange)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>SSP2_loPPkF <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/codedata/SSP2_control_last.rds"</span>)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>biomass_spatial_stanza<span class="ot">=</span>SSP2_loPPkF<span class="sc">$</span>biomass_spatial_stanza</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span><span class="fu">subset</span>(biomass_spatial_stanza,species<span class="sc">==</span><span class="st">"Pocillopora"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites branching"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites massive"</span><span class="sc">|</span>species<span class="sc">==</span><span class="st">"Montipora"</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Leptoseris"</span><span class="sc">|</span> species<span class="sc">==</span><span class="st">"crustose coralline algae"</span>)</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(polygon, time) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Coral_NearShore=</span><span class="fu">sum</span>(atoutput))</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral[ssp2_coral<span class="sc">$</span>polygon <span class="sc">%in%</span> keep, ]</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">%%</span> <span class="dv">1</span>))</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>ssp2_coral[<span class="fu">order</span>(ssp2_coral<span class="sc">$</span>time),]</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">9</span>))</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>t<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">14</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Coral_NearShore))</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">13</span>))</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span><span class="fu">merge</span>(t,ssp2_coral)</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>percentchangeSSP2<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Coral_perchange =</span> Coral_NearShore<span class="sc">/</span>mean)</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>percentchangeSSP2<span class="ot">=</span>percentchangeSSP2[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>percentchangeSSP2<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"time"</span>, percentchangeSSP2<span class="sc">$</span>time )</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>SSP2<span class="ot">=</span><span class="fu">spread</span>(percentchangeSSP2, time, Coral_perchange)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="prediction-model" class="level2">
<h2 class="anchored" data-anchor-id="prediction-model">Prediction Model</h2>
<p>For each scenario predicted by the Atlantis ecosystem model (e.g., SSP1, SSP2, SSP3), we run a simulation loop across all time steps to estimate the welfare impacts of changing nearshore coral biomass.</p>
<p>Specifically, for each year in the scenario:</p>
<ul>
<li><p>Biomass outputs are aggregated spatially (by polygon or site).</p></li>
<li><p>The percentage change in coral reef biomass relative to the baseline is calculated.</p></li>
<li><p>These changes are passed into the Random Utility Model, updating site attributes for each grid-cell household.</p></li>
<li><p>Compensating Variation (CV) is then computed to measure the change in household welfare due to environmental change.</p></li>
</ul>
<p>This process is repeated for each:</p>
<ul>
<li><p>Grid cell (representing origin locations of visitors)</p></li>
<li><p>Recreational site (destination choices)</p></li>
<li><p>Time step (e.g., yearly from 2025 to 2100)</p></li>
<li><p>Scenario (SSP1–3)</p></li>
</ul>
<section id="predict-ssp1" class="level3">
<h3 class="anchored" data-anchor-id="predict-ssp1">Predict SSP1</h3>
<p>Below is a loop (conceptual or in code) that:</p>
<ul>
<li><p>Iterates through each time step of the SSP1 scenario</p></li>
<li><p>Updates coral biomass conditions</p></li>
<li><p>Recalculates utilities and choice probabilities</p></li>
<li><p>Estimates welfare change (CV) for each grid-location pair</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">### parameters</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> m3<span class="sc">$</span>results[,<span class="dv">1</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Considering a transfer to Oahu:</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>x1[<span class="fu">is.na</span>(x1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( x1<span class="sc">$</span>cost,x1<span class="sc">$</span>home, x1<span class="sc">$</span>coastal, x1<span class="sc">$</span>citypark, x1<span class="sc">$</span>trailall,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>haleakala, x1<span class="sc">$</span>molokini, x1<span class="sc">$</span>parking, x1<span class="sc">$</span>showers,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>lifeguard, x1<span class="sc">$</span>rock, x1<span class="sc">$</span>manmade, x1<span class="sc">$</span>beachmedium, x1<span class="sc">$</span>beachlarge, x1<span class="sc">$</span>surf,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>swim, x1<span class="sc">$</span>snork, x1<span class="sc">$</span>res_fish_bio, x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>playground, x1<span class="sc">$</span>sports,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>res_fish_bio)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>X0[<span class="fu">is.na</span>(X0)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(final) &lt;- c("time10",  "time20" , "time30" , "time40")</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">#this needs to be ran as a loop</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">82</span>) {</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS <span class="ot">&lt;-</span> xsim<span class="sc">$</span>PNAS <span class="sc">*</span>xsim[,i]</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS[xsim<span class="sc">$</span>PNAS <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( xsim<span class="sc">$</span>cost,xsim<span class="sc">$</span>home, xsim<span class="sc">$</span>coastal, xsim<span class="sc">$</span>citypark, xsim<span class="sc">$</span>trailall,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>haleakala, xsim<span class="sc">$</span>molokini, xsim<span class="sc">$</span>parking, xsim<span class="sc">$</span>showers,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>lifeguard, xsim<span class="sc">$</span>rock, xsim<span class="sc">$</span>manmade, xsim<span class="sc">$</span>beachmedium, xsim<span class="sc">$</span>beachlarge, xsim<span class="sc">$</span>surf,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>swim, xsim<span class="sc">$</span>snork, xsim<span class="sc">$</span>res_fish_bio, xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>playground, xsim<span class="sc">$</span>sports,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>res_fish_bio)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  X1[<span class="fu">is.na</span>(X1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">### CALCULATION OF WTP FOR EACH GRID LOCATION</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  wtpw <span class="ot">&lt;-</span> <span class="fu">quality.change</span>(<span class="at">beta =</span> beta, <span class="do">### parameters</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X0=</span>X0,     <span class="do">### X variables in the baseline</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X1 =</span> X1,   <span class="do">#### X variables in the scenario</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pid =</span> x1<span class="sc">$</span>km2_ID,    <span class="do">### ID of the 1km grid</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cost =</span><span class="dv">1</span>)       <span class="do">### column of the cost parameter in the X matrix</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">### TOTAL WTP</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span><span class="fu">merge</span>(wtpw,out, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">"id"</span>),<span class="at">by.y=</span><span class="fu">c</span>(<span class="st">"km2_ID"</span>))</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  b<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">=</span>b <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SSP1_block=</span><span class="fu">sum</span>(WTP <span class="sc">*</span> incometran_track<span class="sc">*</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  all<span class="ot">=</span><span class="fu">rbind</span>(b,all)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  final<span class="ot">=</span><span class="fu">rbind</span>(a,final)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>final</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>all_df<span class="ot">=</span>all</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_df)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP1"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="predict-ssp2" class="level3">
<h3 class="anchored" data-anchor-id="predict-ssp2">Predict SSP2</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">####This is for SSP2</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">merge</span>(dist1, sites_join)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>coastal[x1<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Home"</span>]<span class="ot">=</span><span class="dv">0</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="fu">merge</span>(SSP2, x1, <span class="at">by.x =</span> <span class="st">"polygon"</span>, <span class="at">by.y =</span> <span class="st">"Box_ID_2"</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>km2_ID,x1<span class="sc">$</span>siteID),]   <span class="do">## btw it is correct that the dim(x) is lower than dim(dist) because</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="do">## I aggregated some sites</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(x1<span class="sc">$</span>siteID))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="do">### FINISHED LOADING AND MERGING DATASETS </span><span class="al">###</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(dist, pop, sitesjoin)</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE TRAVEL COST ####</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="sc">+</span> <span class="dv">40</span>       <span class="do">## this sites needs 40min walking to be reached</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Need to also do this for Hawaii</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="do">### Change here for different fuel cost</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>distance.meters<span class="sc">*</span><span class="fl">0.001</span> <span class="sc">*</span> (<span class="fl">0.20</span> <span class="sc">/</span> <span class="fl">1.5</span>   )               <span class="do">## fuel cost </span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="do">## assumption on fuel cost:</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 miles/gallon</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># $4.3/gallon</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="co"># means $4.3 per 20 miles --&gt; 0.215 $/mile</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km --&gt; 6.2 miles --&gt; $1.33 travel cost per km</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 10km * 0.20 / 1.5 = $1.33  so the values coincide with the cost used above.</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">+</span> (x1<span class="sc">$</span>duration <span class="sc">/</span> <span class="dv">60</span>)<span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">24.14</span>    <span class="do">## add the value of time (assuming a 25$ per hour average wage rate)</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">*</span> <span class="dv">2</span>                          <span class="do">## the value for a return trip</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="do">#### put Molokini cost equal to the one of Makena Landing Beach Park + 100$ (cost of a snorkeling tour)</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">388</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">359</span>] <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="do">### PREPARE DATA FOR PREDICTIONS </span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="do">### parameters</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> m3<span class="sc">$</span>results[,<span class="dv">1</span>]</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="do">### Considering a transfer to Oahu:</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>x1[<span class="fu">is.na</span>(x1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( x1<span class="sc">$</span>cost,x1<span class="sc">$</span>home, x1<span class="sc">$</span>coastal, x1<span class="sc">$</span>citypark, x1<span class="sc">$</span>trailall,</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>haleakala, x1<span class="sc">$</span>molokini, x1<span class="sc">$</span>parking, x1<span class="sc">$</span>showers,</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>lifeguard, x1<span class="sc">$</span>rock, x1<span class="sc">$</span>manmade, x1<span class="sc">$</span>beachmedium, x1<span class="sc">$</span>beachlarge, x1<span class="sc">$</span>surf,</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>swim, x1<span class="sc">$</span>snork, x1<span class="sc">$</span>res_fish_bio, x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>playground, x1<span class="sc">$</span>sports,</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>res_fish_bio)</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>X0[<span class="fu">is.na</span>(X0)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(final) &lt;- c("time10",  "time20" , "time30" , "time40")</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a><span class="co">#this needs to be ran as a loop</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">83</span>) {</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>  xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS <span class="ot">&lt;-</span> xsim<span class="sc">$</span>PNAS <span class="sc">*</span>xsim[,i]</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS[xsim<span class="sc">$</span>PNAS <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( xsim<span class="sc">$</span>cost,xsim<span class="sc">$</span>home, xsim<span class="sc">$</span>coastal, xsim<span class="sc">$</span>citypark, xsim<span class="sc">$</span>trailall,</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>haleakala, xsim<span class="sc">$</span>molokini, xsim<span class="sc">$</span>parking, xsim<span class="sc">$</span>showers,</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>lifeguard, xsim<span class="sc">$</span>rock, xsim<span class="sc">$</span>manmade, xsim<span class="sc">$</span>beachmedium, xsim<span class="sc">$</span>beachlarge, xsim<span class="sc">$</span>surf,</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>swim, xsim<span class="sc">$</span>snork, xsim<span class="sc">$</span>res_fish_bio, xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>playground, xsim<span class="sc">$</span>sports,</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>res_fish_bio)</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>  X1[<span class="fu">is.na</span>(X1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>  <span class="do">### CALCULATION OF WTP FOR EACH GRID LOCATION</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  wtpw <span class="ot">&lt;-</span> <span class="fu">quality.change</span>(<span class="at">beta =</span> beta, <span class="do">### parameters</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X0=</span>X0,     <span class="do">### X variables in the baseline</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X1 =</span> X1,   <span class="do">#### X variables in the scenario</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pid =</span> x1<span class="sc">$</span>km2_ID,    <span class="do">### ID of the 1km grid</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cost =</span><span class="dv">1</span>)       <span class="do">### column of the cost parameter in the X matrix</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>  <span class="do">### TOTAL WTP</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span><span class="fu">merge</span>(wtpw,out, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">"id"</span>),<span class="at">by.y=</span><span class="fu">c</span>(<span class="st">"km2_ID"</span>))</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>  b<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">=</span>b <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SSP2_block=</span><span class="fu">sum</span>(WTP <span class="sc">*</span> incometran_track<span class="sc">*</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>)</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>  all<span class="ot">=</span><span class="fu">rbind</span>(b,all)</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>  final<span class="ot">=</span><span class="fu">rbind</span>(a,final)</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">merge</span>(df,final, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP2"</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>all_df<span class="ot">=</span><span class="fu">merge</span>(all_df, all, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="predict-ssp3" class="level3">
<h3 class="anchored" data-anchor-id="predict-ssp3">Predict SSP3</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">####This is for SSP3</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">merge</span>(dist1, sites_join)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>coastal[x1<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Home"</span>]<span class="ot">=</span><span class="dv">0</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="fu">merge</span>(SSP3, x1, <span class="at">by.x =</span> <span class="st">"polygon"</span>, <span class="at">by.y =</span> <span class="st">"Box_ID_2"</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>km2_ID,x1<span class="sc">$</span>siteID),]   <span class="do">## btw it is correct that the dim(x) is lower than dim(dist) because</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="do">## I aggregated some sites</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(x1<span class="sc">$</span>siteID))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="do">### FINISHED LOADING AND MERGING DATASETS </span><span class="al">###</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE TRAVEL COST ####</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="sc">+</span> <span class="dv">40</span>       <span class="do">## this sites needs 40min walking to be reached</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Need to also do this for Hawaii</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="do">### Change here for different fuel cost</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>distance.meters<span class="sc">*</span><span class="fl">0.001</span> <span class="sc">*</span> (<span class="fl">0.20</span> <span class="sc">/</span> <span class="fl">1.5</span>   )               <span class="do">## fuel cost </span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="do">## assumption on fuel cost:</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 miles/gallon</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># $4.3/gallon</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># means $4.3 per 20 miles --&gt; 0.215 $/mile</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km --&gt; 6.2 miles --&gt; $1.33 travel cost per km</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 10km * 0.20 / 1.5 = $1.33  so the values coincide with the cost used above.</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">+</span> (x1<span class="sc">$</span>duration <span class="sc">/</span> <span class="dv">60</span>)<span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">24.14</span>    <span class="do">## add the value of time (assuming a 25$ per hour average wage rate)</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">*</span> <span class="dv">2</span>                          <span class="do">## the value for a return trip</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="do">#### put Molokini cost equal to the one of Makena Landing Beach Park + 100$ (cost of a snorkeling tour)</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">388</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">359</span>] <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="do">### PREPARE DATA FOR PREDICTIONS </span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="do">### parameters</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> m3<span class="sc">$</span>results[,<span class="dv">1</span>]</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="do">### Considering a transfer to Oahu:</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>x1[<span class="fu">is.na</span>(x1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( x1<span class="sc">$</span>cost,x1<span class="sc">$</span>home, x1<span class="sc">$</span>coastal, x1<span class="sc">$</span>citypark, x1<span class="sc">$</span>trailall,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>haleakala, x1<span class="sc">$</span>molokini, x1<span class="sc">$</span>parking, x1<span class="sc">$</span>showers,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>lifeguard, x1<span class="sc">$</span>rock, x1<span class="sc">$</span>manmade, x1<span class="sc">$</span>beachmedium, x1<span class="sc">$</span>beachlarge, x1<span class="sc">$</span>surf,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>swim, x1<span class="sc">$</span>snork, x1<span class="sc">$</span>res_fish_bio, x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>playground, x1<span class="sc">$</span>sports,</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>res_fish_bio)</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>X0[<span class="fu">is.na</span>(X0)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(final) &lt;- c("time10",  "time20" , "time30" , "time40")</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co">#this needs to be ran as a loop</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">83</span>) {</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS <span class="ot">&lt;-</span> xsim<span class="sc">$</span>PNAS <span class="sc">*</span>xsim[,i]</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS[xsim<span class="sc">$</span>PNAS <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( xsim<span class="sc">$</span>cost,xsim<span class="sc">$</span>home, xsim<span class="sc">$</span>coastal, xsim<span class="sc">$</span>citypark, xsim<span class="sc">$</span>trailall,</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>haleakala, xsim<span class="sc">$</span>molokini, xsim<span class="sc">$</span>parking, xsim<span class="sc">$</span>showers,</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>lifeguard, xsim<span class="sc">$</span>rock, xsim<span class="sc">$</span>manmade, xsim<span class="sc">$</span>beachmedium, xsim<span class="sc">$</span>beachlarge, xsim<span class="sc">$</span>surf,</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>swim, xsim<span class="sc">$</span>snork, xsim<span class="sc">$</span>res_fish_bio, xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>playground, xsim<span class="sc">$</span>sports,</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>res_fish_bio)</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>  X1[<span class="fu">is.na</span>(X1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>  <span class="do">### CALCULATION OF WTP FOR EACH GRID LOCATION</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>  wtpw <span class="ot">&lt;-</span> <span class="fu">quality.change</span>(<span class="at">beta =</span> beta, <span class="do">### parameters</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X0=</span>X0,     <span class="do">### X variables in the baseline</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X1 =</span> X1,   <span class="do">#### X variables in the scenario</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pid =</span> x1<span class="sc">$</span>km2_ID,    <span class="do">### ID of the 1km grid</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cost =</span><span class="dv">1</span>)       <span class="do">### column of the cost parameter in the X matrix</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>  <span class="do">### TOTAL WTP</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span><span class="fu">merge</span>(wtpw,out, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">"id"</span>),<span class="at">by.y=</span><span class="fu">c</span>(<span class="st">"km2_ID"</span>))</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>  b<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">=</span>b <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SSP3_block=</span><span class="fu">sum</span>(WTP <span class="sc">*</span> incometran_track<span class="sc">*</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>)</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>  all<span class="ot">=</span><span class="fu">rbind</span>(b,all)</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>  final<span class="ot">=</span><span class="fu">rbind</span>(a,final)</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">merge</span>(df,final, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP3"</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>all_df<span class="ot">=</span><span class="fu">merge</span>(all_df, all, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-aggregation" class="level2">
<h2 class="anchored" data-anchor-id="data-aggregation">Data Aggregation</h2>
<p>Two datasets were created in the prediction modeling.</p>
<ol type="1">
<li>Aggregated Totals by population and income weighted by Island Each Year</li>
<li>Raw Welfare Predictions per KM Grid</li>
</ol>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP1_TotalWTP<span class="ot">=</span>(all_df<span class="sc">$</span>SSP1<span class="sc">*</span>all_df<span class="sc">$</span>incometran_track<span class="sc">*</span>all_df<span class="sc">$</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>) </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP2_TotalWTP<span class="ot">=</span>(all_df<span class="sc">$</span>SSP2<span class="sc">*</span>all_df<span class="sc">$</span>incometran_track<span class="sc">*</span>all_df<span class="sc">$</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>) </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP3_TotalWTP<span class="ot">=</span>(all_df<span class="sc">$</span>SSP3<span class="sc">*</span>all_df<span class="sc">$</span>incometran_track<span class="sc">*</span>all_df<span class="sc">$</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>) </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>wtpssp1_total<span class="ot">=</span>all_df <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year<span class="sc">==</span><span class="dv">2030</span> <span class="sc">|</span> Year<span class="sc">==</span><span class="dv">2050</span> <span class="sc">|</span> Year<span class="sc">==</span><span class="dv">2100</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> wtpssp1_total <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"SSP"</span>),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"SSP_Var"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create wide column names with Year info</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">column_name =</span> <span class="fu">paste0</span>(<span class="st">"year_"</span>, Year, <span class="st">"_"</span>, SSP_Var))</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Pivot wider using those column names</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>df_wide <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, column_name, Value) <span class="sc">%&gt;%</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> column_name, <span class="at">values_from =</span> Value)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_wide, <span class="at">file=</span><span class="st">"allssps_islands.csv"</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>coral<span class="ot">=</span>SSP1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">32</span>,<span class="dv">82</span>)]</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP1_2030"</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP1_2050"</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">"SSP1_2100"</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>coral1<span class="ot">=</span>SSP2[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">32</span>,<span class="dv">82</span>)]</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP2_2030"</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP2_2050"</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">"SSP2_2100"</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>coral<span class="ot">=</span><span class="fu">merge</span>(coral,coral1)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>coral1<span class="ot">=</span>SSP3[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">32</span>,<span class="dv">82</span>)]</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP3_2030"</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP3_2050"</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">"SSP3_2100"</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>coral<span class="ot">=</span><span class="fu">merge</span>(coral,coral1)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(coral, <span class="at">file=</span><span class="st">"coral_new.csv"</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>df1<span class="ot">=</span><span class="fu">gather</span>(df, condition, wtp, SSP1_block<span class="sc">:</span>SSP3_block, <span class="at">factor_key=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>condition<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"_block"</span>, <span class="st">""</span>, df1<span class="sc">$</span>condition)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Kauai"</span>, <span class="st">"Kauaʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Molokai"</span>, <span class="st">"Molokaʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Oahu"</span>, <span class="st">"Oʻahu"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Hawaii"</span>, <span class="st">"Hawaiʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Lanai"</span>, <span class="st">"Lānaʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df1, <span class="at">file=</span><span class="st">"allssps_islands.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="across-island-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="across-island-aggregation">Across Island aggregation</h3>
</section>
<section id="across-island-aggregation-of-welfare-loss" class="level3">
<h3 class="anchored" data-anchor-id="across-island-aggregation-of-welfare-loss">Across-Island Aggregation of Welfare Loss</h3>
<p>This code snippet produces a projected summary table of total welfare loss by island, under each scenario (SSP1–SSP3). The results are aggregated over time and space, incorporating:</p>
<ul>
<li><p>Annual compensating variation (CV) estimates at the grid level</p></li>
<li><p>Population projections for the state of Hawai'i under SSP1–SSP3, used to scale welfare impacts</p>
<p>Two discounting frameworks:</p></li>
<li><p>A standard constant discount rate (e.g., circular A-4 rate, typically 3%)</p></li>
<li><p>A pluralistic (declining or hyperbolic) discount rate, reflecting alternative time preferences in environmental valuation</p></li>
</ul>
<p>These discounted totals provide a long-term estimate of the economic cost of environmental degradation (via coral biomass loss) under different future pathways. The final output summarizes welfare changes per island, scenario, and discounting method, supporting policy evaluation and prioritization.</p>
<p><img src="images/islandgraphpluristic_new.png" class="img-fluid"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>allssps_islands <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/CR/codedata/allssps_islands.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"..."</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>allssps_islandspop <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"allssps_islands.xlsx"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">sheet =</span> <span class="st">"pop"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>allssps_islandspop<span class="ot">=</span><span class="fu">gather</span>(allssps_islandspop,  condition, pop, SSP1<span class="sc">:</span>SSP3, <span class="at">factor_key=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="ot">=</span><span class="fu">merge</span>(allssps_islands,allssps_islandspop)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV[<span class="fu">which</span>(allssps_islands<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">2020</span>)]<span class="ot">=</span>.<span class="dv">02</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV[<span class="fu">which</span>(allssps_islands<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">2079</span>)]<span class="ot">=</span>.<span class="dv">019</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV[<span class="fu">which</span>(allssps_islands<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">2094</span>)]<span class="ot">=</span>.<span class="dv">018</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>time_step <span class="ot">&lt;-</span> allssps_islands<span class="sc">$</span>Year <span class="sc">-</span> <span class="dv">2020</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP<span class="ot">=</span>allssps_islands<span class="sc">$</span>wtp<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>allssps_islands<span class="sc">$</span>NPV)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Pop<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>allssps_islands<span class="sc">$</span>NPV)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">4</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">0</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">1</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">3</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.03</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.1</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic2<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">4</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+-</span>.<span class="dv">01</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">1</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">3</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.01</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.5</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Lane<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.03</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic2<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic2<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Lane<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_Lane<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Pop<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_Pop<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(allssps_islands)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP Scenario"</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(allssps_islands, <span class="fu">aes</span>(<span class="at">x =</span> Year)) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> NPV_WTP_Pop, <span class="at">color =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>, <span class="at">group =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> NPV_WTP_pluristic, <span class="at">color =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>, <span class="at">group =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> NPV_WTP_pluristic, <span class="at">ymax =</span> NPV_WTP_Pop, <span class="at">fill =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>, <span class="at">group =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>),</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">0</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> group.colors) <span class="sc">+</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> group.colors) <span class="sc">+</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>),</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Thousands Dollars"</span>) <span class="sc">+</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Projected Annual Welfare Impacts (in Thousands Dollars)"</span>) <span class="sc">+</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> <span class="fu">factor</span>(island, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Lānaʻi"</span>, <span class="st">"Molokaʻi"</span>, <span class="st">"Kauaʻi"</span>, <span class="st">"Hawaiʻi"</span>, <span class="st">"Maui"</span>, <span class="st">"Oʻahu"</span>)),</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="snap-shot-within-island" class="level3">
<h3 class="anchored" data-anchor-id="snap-shot-within-island">Snap Shot within Island</h3>
<p>The raw welfare estimates generated in previous steps are not yet adjusted for differences in income levels or population density. The next code snippet computes total willingness to pay (WTP) by:</p>
<ul>
<li><p>Aggregating individual welfare estimates by income tract and grid cell</p></li>
<li><p>Weighting by local population to reflect the total affected individuals</p></li>
</ul>
<p>This adjusted dataset is especially useful for understanding distributional impacts of environmental change and for producing spatially explicit visualizations of welfare loss.</p>
<p><strong>In the paper we present 2030, 2050, 2100 but here we have also 2075</strong></p>
<p><img src="images/maps.png" class="img-fluid"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the cutpoints for 7 intervals</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/CR/codedata/all_grids.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"..."</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> all_df <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SSP1_WTP_bin =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e6</span>         <span class="sc">~</span> <span class="st">"≤ -1M"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e5</span>         <span class="sc">~</span> <span class="st">"-1M to -100K"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e3</span>         <span class="sc">~</span> <span class="st">"-100K to -1K"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">100</span>         <span class="sc">~</span> <span class="st">"-1K to -100"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;</span> <span class="dv">0</span>             <span class="sc">~</span> <span class="st">"-100 to 0"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">==</span> <span class="dv">0</span>            <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="dv">100</span>          <span class="sc">~</span> <span class="st">"0 to 100"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e3</span>          <span class="sc">~</span> <span class="st">"100 to 1K"</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e4</span>          <span class="sc">~</span> <span class="st">"1K to 10K"</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                          <span class="sc">~</span> <span class="st">"&gt; 10K"</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> all_df <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SSP2_WTP_bin =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e6</span>         <span class="sc">~</span> <span class="st">"≤ -1M"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e5</span>         <span class="sc">~</span> <span class="st">"-1M to -100K"</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e3</span>         <span class="sc">~</span> <span class="st">"-100K to -1K"</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">100</span>         <span class="sc">~</span> <span class="st">"-1K to -100"</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;</span> <span class="dv">0</span>             <span class="sc">~</span> <span class="st">"-100 to 0"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">==</span> <span class="dv">0</span>            <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="dv">100</span>          <span class="sc">~</span> <span class="st">"0 to 100"</span>,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e3</span>          <span class="sc">~</span> <span class="st">"100 to 1K"</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e4</span>          <span class="sc">~</span> <span class="st">"1K to 10K"</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                          <span class="sc">~</span> <span class="st">"&gt; 10K"</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> all_df <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SSP3_WTP_bin =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e6</span>         <span class="sc">~</span> <span class="st">"≤ -1M"</span>,</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e5</span>         <span class="sc">~</span> <span class="st">"-1M to -100K"</span>,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e3</span>         <span class="sc">~</span> <span class="st">"-100K to -1K"</span>,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">100</span>         <span class="sc">~</span> <span class="st">"-1K to -100"</span>,</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;</span> <span class="dv">0</span>             <span class="sc">~</span> <span class="st">"-100 to 0"</span>,</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">==</span> <span class="dv">0</span>            <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="dv">100</span>          <span class="sc">~</span> <span class="st">"0 to 100"</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e3</span>          <span class="sc">~</span> <span class="st">"100 to 1K"</span>,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e4</span>          <span class="sc">~</span> <span class="st">"1K to 10K"</span>,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                          <span class="sc">~</span> <span class="st">"&gt; 10K"</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"≤ -1M"</span>         <span class="ot">=</span> <span class="st">"darkred"</span>,</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1M to -100K"</span>  <span class="ot">=</span> <span class="st">"brown"</span>,</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100K to -1K"</span>  <span class="ot">=</span> <span class="st">"lightcoral"</span>,</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1K to -100"</span>   <span class="ot">=</span> <span class="st">"pink"</span>,</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100 to 0"</span>     <span class="ot">=</span> <span class="st">"mistyrose"</span>,</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0"</span>             <span class="ot">=</span> <span class="st">"white"</span>,</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0 to 100"</span>      <span class="ot">=</span> <span class="st">"greenyellow"</span>,</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>  <span class="st">"100 to 1K"</span>     <span class="ot">=</span> <span class="st">"limegreen"</span>,</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&gt; 10K"</span>         <span class="ot">=</span> <span class="st">"darkgreen"</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP1_WTP_bin <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>  all_df<span class="sc">$</span>SSP1_WTP_bin,</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP2_WTP_bin <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  all_df<span class="sc">$</span>SSP2_WTP_bin,</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP2_WTP_bin <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>  all_df<span class="sc">$</span>SSP2_WTP_bin,</span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Then plot:</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2050</span>, <span class="dv">2075</span>, <span class="dv">2100</span>)),</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP1_WTP_bin)</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> hawaii_counties,</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fl">0.4</span>,</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Year), <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="animation-welfare" class="level2">
<h2 class="anchored" data-anchor-id="animation-welfare">Animation Welfare</h2>
<p>These produce animations of changes in annual welfare to the year 2100</p>
<ul>
<li>The code chunk runs the animation and saves the file.</li>
<li>The Markdown line right after brings the GIF into the rendered output.</li>
<li>Make sure the GIF file path is correct relative to the document, or specify the path if needed.</li>
</ul>
<p>Legend for the following animations</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"≤ -1M"</span>        <span class="ot">=</span> <span class="st">"darkred"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1M to -100K"</span> <span class="ot">=</span> <span class="st">"brown"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100K to -1K"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1K to -100"</span>  <span class="ot">=</span> <span class="st">"pink"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100 to 0"</span>    <span class="ot">=</span> <span class="st">"mistyrose"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0"</span>            <span class="ot">=</span> <span class="st">"white"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0 to 100"</span>     <span class="ot">=</span> <span class="st">"greenyellow"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"100 to 1K"</span>    <span class="ot">=</span> <span class="st">"limegreen"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&gt; 10K"</span>        <span class="ot">=</span> <span class="st">"darkgreen"</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a blank plot canvas</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">yaxt =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"n"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the standalone legend</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"center"</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">names</span>(color_palette),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill   =</span> <span class="fu">unname</span>(color_palette),</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">bty    =</span> <span class="st">"o"</span>,           <span class="co"># border around legend</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex    =</span> <span class="fl">1.0</span>,           <span class="co"># text size</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">title  =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">title.cex =</span> <span class="fl">1.2</span>,        <span class="co"># title size</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol   =</span> <span class="dv">1</span>,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">xpd    =</span> <span class="cn">TRUE</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="CoralReef_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="ssp1" class="level3">
<h3 class="anchored" data-anchor-id="ssp1">SSP1</h3>
<p>2030&gt;&gt;&gt;&gt;2100</p>
<p><img src="images/hawaii_wtpssp1_animation.gif" class="img-fluid"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2100</span>)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP1_WTP_bin),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>    <span class="fu">geom_sf</span>(<span class="at">data =</span> hawaii_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'SSP1 Year: {closest_state}'</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transition_states</span>(Year, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ease_aes</span>(<span class="st">'cubic-in-out'</span>) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shadow_wake</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">wake_length =</span> <span class="fl">0.2</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(anim, <span class="at">nframes =</span> <span class="dv">81</span>, <span class="at">fps =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"hawaii_wtpssp1_animation.gif"</span>, <span class="at">animation =</span> <span class="fu">last_animation</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ssp2" class="level3">
<h3 class="anchored" data-anchor-id="ssp2">SSP2</h3>
<p>2030&gt;&gt;&gt;&gt;2100</p>
<p><img src="images/hawaii_wtpssp2_animation.gif" class="img-fluid"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2100</span>)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP2_WTP_bin),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>    <span class="fu">geom_sf</span>(<span class="at">data =</span> hawaii_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'SSP2 Year: {closest_state}'</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transition_states</span>(Year, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ease_aes</span>(<span class="st">'cubic-in-out'</span>) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shadow_wake</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">wake_length =</span> <span class="fl">0.2</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(anim, <span class="at">nframes =</span> <span class="dv">81</span>, <span class="at">fps =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"hawaii_wtpssp2_animation.gif"</span>, <span class="at">animation =</span> <span class="fu">last_animation</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ssp3" class="level3">
<h3 class="anchored" data-anchor-id="ssp3">SSP3</h3>
<p>2030&gt;&gt;&gt;&gt;2100</p>
<p><img src="images/hawaii_wtpssp3_animation.gif" class="img-fluid"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2100</span>)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP3_WTP_bin),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>    <span class="fu">geom_sf</span>(<span class="at">data =</span> hawaii_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'SSP3 Year: {closest_state}'</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transition_states</span>(Year, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ease_aes</span>(<span class="st">'cubic-in-out'</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shadow_wake</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">wake_length =</span> <span class="fl">0.2</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(anim, <span class="at">nframes =</span> <span class="dv">81</span>, <span class="at">fps =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"hawaii_wtpssp3_animation.gif"</span>, <span class="at">animation =</span> <span class="fu">last_animation</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb22" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "The economic impact of climate change on coral reef in the Main Hawaiian Islands"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Ashley Lowe Mackenzie et. al"</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true        # Enables dropdown for code</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true       # (Optional) Adds buttons like "Show Code"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show code"  # (Optional) Custom label for dropdown</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">    page-layout: full</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Coral Reef Hawaii</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>The following code estimates welfare changes associated with varying conditions of nearshore environmental quality on the island of Hawai\'i. The primary impact considered is the loss of coral reef biomass, which serves as an environmental and economic asset. Welfare effects are estimated through two distinct models that capture changes in household utility and behavioral responses to environmental degradation. These models use observed visitation and population data to approximate demand, and they translate changes in reef quality into utility impacts, following standard approaches in environmental and recreational economics. The two models include:</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>An Economic Model using a random utility framework from <span class="co">[</span><span class="ot">Fezzi. et al 2023</span><span class="co">](https://doi.org/10.1016/j.ecolecon.2022.107628)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Atlantic Biophysical Sub-Model which estimates changes to ecological conditions.</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>The graphical representation of this process is illustrated below</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/Figure2.png)</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Running Code</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>This section calls the necessary R packages and sources external scripts from the original study. These scripts provide the estimated coefficients from the Random Utility Model (RUM), which will be used to simulate individual preferences and estimate welfare changes under different environmental quality scenarios. These parameters reflect the marginal utility of various site attributes, including coral reef biomass, travel cost, and environmental conditions.</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="do">### load functions</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/CR/codedata/dummier.R"</span>)</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/CR/codedata/travel_cost.R"</span>)</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/CR/codedata/gridplot.R"</span>)</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="do">### load model </span><span class="al">###</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"~/CR/codedata/model3.mod"</span>)</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="do">### this are the travel cost model estimates </span><span class="al">###</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>m1</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Travel Cost</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>The following code calculates the **travel cost** from each residential grid to each recreation site across the Hawaiian Islands. It uses economic and geographic data collected from each island, including household income, travel distance, and mode assumptions.</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>Travel costs are estimated following the methodology of **Fezzi et al. (2023)**, who incorporate both time and monetary expenses into a unified measure of generalized cost. These estimates serve as one of the key explanatory variables in the Random Utility Model (RUM), which is used to simulate recreation site choice.</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>dist1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/codedata/dist1.csv"</span>)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>sites_join <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/codedata/sites_join.csv"</span>)</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">merge</span>(dist1, sites_join)</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>coastal[x1<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Home"</span>]<span class="ot">=</span><span class="dv">0</span> </span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a><span class="do">### Prepared dataset for maps plot:</span></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>siteID),]</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> out[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">8</span><span class="sc">:</span><span class="dv">12</span>)]</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a><span class="do">##using 85K because that was the survey amount</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>incometran_track<span class="ot">=</span>out<span class="sc">$</span>medincome_tract<span class="sc">/</span><span class="dv">85000</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>coasts <span class="ot">&lt;-</span> sites[sites<span class="sc">$</span>coastal <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> sites<span class="sc">$</span>name<span class="sc">!=</span><span class="st">"Home"</span>,]</span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="fu">merge</span>(SSP1, x1, <span class="at">by.x =</span> <span class="st">"polygon"</span>, <span class="at">by.y =</span> <span class="st">"Box_ID_2"</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>km2_ID,x1<span class="sc">$</span>siteID),]   <span class="do">## btw it is correct that the dim(x) is lower than dim(dist) because</span></span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a><span class="do">## I aggregated some sites</span></span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(x1<span class="sc">$</span>siteID))</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a><span class="do">### FINISHED LOADING AND MERGING DATASETS </span><span class="al">###</span></span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(dist, pop, sitesjoin)</span></span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE TRAVEL COST ####</span></span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="sc">+</span> <span class="dv">40</span>       <span class="do">## this sites needs 40min walking to be reached</span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a><span class="do">## Need to also do this for Hawaii</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a><span class="do">### Change here for different fuel cost</span></span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>distance.meters<span class="sc">*</span><span class="fl">0.001</span> <span class="sc">*</span> (<span class="fl">0.20</span> <span class="sc">/</span> <span class="fl">1.5</span>   )               <span class="do">## fuel cost </span></span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a><span class="do">## assumption on fuel cost:</span></span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 miles/gallon</span></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a><span class="co"># $4.3/gallon</span></span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a><span class="co"># means $4.3 per 20 miles --&gt; 0.215 $/mile</span></span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km --&gt; 6.2 miles --&gt; $1.33 travel cost per km</span></span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a><span class="co"># 10km * 0.20 / 1.5 = $1.33  so the values coincide with the cost used above.</span></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">+</span> (x1<span class="sc">$</span>duration <span class="sc">/</span> <span class="dv">60</span>)<span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">24.14</span>    <span class="do">## add the value of time (assuming a 25$ per hour average wage rate)</span></span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">*</span> <span class="dv">2</span>                          <span class="do">## the value for a return trip</span></span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a><span class="do">#### put Molokini cost equal to the one of Makena Landing Beach Park + 100$ (cost of a snorkeling tour)</span></span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">388</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">359</span>] <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a><span class="fu">## Atlantis Model</span></span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>To assess environmental changes in the nearshore ecosystem, we incorporate biomass outputs from the Atlantis ecosystem model. These outputs represent projected ecological dynamics---specifically, coral reef and associated species biomass---under different management and environmental scenarios.</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>The biomass values will be:</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatially aggregated by polygon to match the resolution used in the economic model.</span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Processed annually to calculate percentage changes in biomass relative to the baseline year.</span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>These percentage changes provide the key environmental quality metric (e.g., reef health) that feeds into the Economic Model outlined in the previous section. Specifically, the estimated changes will modify site attributes within the Random Utility Model framework to simulate how changes in reef biomass affect recreational behavior and welfare.</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a><span class="fu">### Base level Coral</span></span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>The base level of coral is the average biomass of 2015-2020 for each near polygon.</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/match_boxs.png)</span></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### Yearly Percent Change</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>Then for each time step out to 2100 we sum up the biomass of coral reef:</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>$C_{pt} = \sum V_{pt} / \sum V_{pt}=0$</span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>The following code does this for scenario SSP1 1-3. The file required if from the Atlantis which is to large for github so please request.</span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a><span class="do">###This grabs Atlantis and gets it into the write steps</span></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a>SSP3_loPPkF <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/codedata/SSP3_control_last.rds"</span>)</span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>biomass_spatial_stanza<span class="ot">=</span>SSP3_loPPkF<span class="sc">$</span>biomass_spatial_stanza</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span><span class="fu">subset</span>(biomass_spatial_stanza,species<span class="sc">==</span><span class="st">"Pocillopora"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites branching"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites massive"</span><span class="sc">|</span>species<span class="sc">==</span><span class="st">"Montipora"</span></span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Leptoseris"</span>)</span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="sc">$</span>time<span class="ot">=</span><span class="fu">round</span>(ssp3_coral<span class="sc">$</span>time, <span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(time, polygon, species, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(polygon, time) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Coral_NearShore=</span><span class="fu">sum</span>(atoutput))</span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral[ssp3_coral<span class="sc">$</span>polygon <span class="sc">%in%</span> keep, ]</span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">%%</span> <span class="dv">1</span>))</span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a>ssp3_coral[<span class="fu">order</span>(ssp3_coral<span class="sc">$</span>time),]</span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">9</span>))</span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>t<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">14</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Coral_NearShore))</span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">13</span>))</span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a>ssp3_coral<span class="ot">=</span><span class="fu">merge</span>(t,ssp3_coral)</span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a>percentchangeSSP3<span class="ot">=</span>ssp3_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span></span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Coral_perchange =</span> Coral_NearShore<span class="sc">/</span>mean)</span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a>percentchangeSSP3<span class="ot">=</span>percentchangeSSP3[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a>percentchangeSSP3<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"time"</span>, percentchangeSSP3<span class="sc">$</span>time )</span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a>SSP3<span class="ot">=</span><span class="fu">spread</span>(percentchangeSSP3, time, Coral_perchange)</span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a>SSP1_loPPkF <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/codedata/SSP1_control_last.rds"</span>)</span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a>biomass_spatial_stanza<span class="ot">=</span>SSP1_loPPkF<span class="sc">$</span>biomass_spatial_stanza</span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span><span class="fu">subset</span>(biomass_spatial_stanza,species<span class="sc">==</span><span class="st">"Pocillopora"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites branching"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites massive"</span><span class="sc">|</span>species<span class="sc">==</span><span class="st">"Montipora"</span></span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Leptoseris"</span>)</span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(polygon, time) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Coral_NearShore=</span><span class="fu">sum</span>(atoutput))</span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral[ssp1_coral<span class="sc">$</span>polygon <span class="sc">%in%</span> keep, ]</span>
<span id="cb22-181"><a href="#cb22-181" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-182"><a href="#cb22-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">%%</span> <span class="dv">1</span>))</span>
<span id="cb22-183"><a href="#cb22-183" aria-hidden="true" tabindex="-1"></a>ssp1_coral[<span class="fu">order</span>(ssp1_coral<span class="sc">$</span>time),]</span>
<span id="cb22-184"><a href="#cb22-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-185"><a href="#cb22-185" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-186"><a href="#cb22-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">9</span>))</span>
<span id="cb22-187"><a href="#cb22-187" aria-hidden="true" tabindex="-1"></a>t<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">14</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb22-188"><a href="#cb22-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Coral_NearShore))</span>
<span id="cb22-189"><a href="#cb22-189" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-190"><a href="#cb22-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">13</span>))</span>
<span id="cb22-191"><a href="#cb22-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-192"><a href="#cb22-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-193"><a href="#cb22-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-194"><a href="#cb22-194" aria-hidden="true" tabindex="-1"></a>ssp1_coral<span class="ot">=</span><span class="fu">merge</span>(t,ssp1_coral)</span>
<span id="cb22-195"><a href="#cb22-195" aria-hidden="true" tabindex="-1"></a>percentchangeSSP1<span class="ot">=</span>ssp1_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-196"><a href="#cb22-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span></span>
<span id="cb22-197"><a href="#cb22-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Coral_perchange =</span> Coral_NearShore<span class="sc">/</span>mean)</span>
<span id="cb22-198"><a href="#cb22-198" aria-hidden="true" tabindex="-1"></a>percentchangeSSP1<span class="ot">=</span>percentchangeSSP1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb22-199"><a href="#cb22-199" aria-hidden="true" tabindex="-1"></a>percentchangeSSP1<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"time"</span>, percentchangeSSP1<span class="sc">$</span>time )</span>
<span id="cb22-200"><a href="#cb22-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-201"><a href="#cb22-201" aria-hidden="true" tabindex="-1"></a>SSP1<span class="ot">=</span><span class="fu">spread</span>(percentchangeSSP1, time, Coral_perchange)</span>
<span id="cb22-202"><a href="#cb22-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-203"><a href="#cb22-203" aria-hidden="true" tabindex="-1"></a>SSP2_loPPkF <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/codedata/SSP2_control_last.rds"</span>)</span>
<span id="cb22-204"><a href="#cb22-204" aria-hidden="true" tabindex="-1"></a>biomass_spatial_stanza<span class="ot">=</span>SSP2_loPPkF<span class="sc">$</span>biomass_spatial_stanza</span>
<span id="cb22-205"><a href="#cb22-205" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span><span class="fu">subset</span>(biomass_spatial_stanza,species<span class="sc">==</span><span class="st">"Pocillopora"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites branching"</span> <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Porites massive"</span><span class="sc">|</span>species<span class="sc">==</span><span class="st">"Montipora"</span></span>
<span id="cb22-206"><a href="#cb22-206" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">|</span>species<span class="sc">==</span><span class="st">"Leptoseris"</span><span class="sc">|</span> species<span class="sc">==</span><span class="st">"crustose coralline algae"</span>)</span>
<span id="cb22-207"><a href="#cb22-207" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(polygon, time) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Coral_NearShore=</span><span class="fu">sum</span>(atoutput))</span>
<span id="cb22-208"><a href="#cb22-208" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral[ssp2_coral<span class="sc">$</span>polygon <span class="sc">%in%</span> keep, ]</span>
<span id="cb22-209"><a href="#cb22-209" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-210"><a href="#cb22-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">%%</span> <span class="dv">1</span>))</span>
<span id="cb22-211"><a href="#cb22-211" aria-hidden="true" tabindex="-1"></a>ssp2_coral[<span class="fu">order</span>(ssp2_coral<span class="sc">$</span>time),]</span>
<span id="cb22-212"><a href="#cb22-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-213"><a href="#cb22-213" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-214"><a href="#cb22-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">9</span>))</span>
<span id="cb22-215"><a href="#cb22-215" aria-hidden="true" tabindex="-1"></a>t<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span> <span class="fu">filter</span>(time<span class="sc">&lt;=</span><span class="dv">14</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb22-216"><a href="#cb22-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Coral_NearShore))</span>
<span id="cb22-217"><a href="#cb22-217" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-218"><a href="#cb22-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(time <span class="sc">&lt;=</span> <span class="dv">13</span>))</span>
<span id="cb22-219"><a href="#cb22-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-220"><a href="#cb22-220" aria-hidden="true" tabindex="-1"></a>ssp2_coral<span class="ot">=</span><span class="fu">merge</span>(t,ssp2_coral)</span>
<span id="cb22-221"><a href="#cb22-221" aria-hidden="true" tabindex="-1"></a>percentchangeSSP2<span class="ot">=</span>ssp2_coral <span class="sc">%&gt;%</span></span>
<span id="cb22-222"><a href="#cb22-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(polygon) <span class="sc">%&gt;%</span></span>
<span id="cb22-223"><a href="#cb22-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Coral_perchange =</span> Coral_NearShore<span class="sc">/</span>mean)</span>
<span id="cb22-224"><a href="#cb22-224" aria-hidden="true" tabindex="-1"></a>percentchangeSSP2<span class="ot">=</span>percentchangeSSP2[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]</span>
<span id="cb22-225"><a href="#cb22-225" aria-hidden="true" tabindex="-1"></a>percentchangeSSP2<span class="sc">$</span>time<span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^"</span>, <span class="st">"time"</span>, percentchangeSSP2<span class="sc">$</span>time )</span>
<span id="cb22-226"><a href="#cb22-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-227"><a href="#cb22-227" aria-hidden="true" tabindex="-1"></a>SSP2<span class="ot">=</span><span class="fu">spread</span>(percentchangeSSP2, time, Coral_perchange)</span>
<span id="cb22-228"><a href="#cb22-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-229"><a href="#cb22-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-230"><a href="#cb22-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-231"><a href="#cb22-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-232"><a href="#cb22-232" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prediction Model</span></span>
<span id="cb22-233"><a href="#cb22-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-234"><a href="#cb22-234" aria-hidden="true" tabindex="-1"></a>For each scenario predicted by the Atlantis ecosystem model (e.g., SSP1, SSP2, SSP3), we run a simulation loop across all time steps to estimate the welfare impacts of changing nearshore coral biomass.</span>
<span id="cb22-235"><a href="#cb22-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-236"><a href="#cb22-236" aria-hidden="true" tabindex="-1"></a>Specifically, for each year in the scenario:</span>
<span id="cb22-237"><a href="#cb22-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-238"><a href="#cb22-238" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Biomass outputs are aggregated spatially (by polygon or site).</span>
<span id="cb22-239"><a href="#cb22-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-240"><a href="#cb22-240" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The percentage change in coral reef biomass relative to the baseline is calculated.</span>
<span id="cb22-241"><a href="#cb22-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-242"><a href="#cb22-242" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These changes are passed into the Random Utility Model, updating site attributes for each grid-cell household.</span>
<span id="cb22-243"><a href="#cb22-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-244"><a href="#cb22-244" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Compensating Variation (CV) is then computed to measure the change in household welfare due to environmental change.</span>
<span id="cb22-245"><a href="#cb22-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-246"><a href="#cb22-246" aria-hidden="true" tabindex="-1"></a>This process is repeated for each:</span>
<span id="cb22-247"><a href="#cb22-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-248"><a href="#cb22-248" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Grid cell (representing origin locations of visitors)</span>
<span id="cb22-249"><a href="#cb22-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-250"><a href="#cb22-250" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recreational site (destination choices)</span>
<span id="cb22-251"><a href="#cb22-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-252"><a href="#cb22-252" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Time step (e.g., yearly from 2025 to 2100)</span>
<span id="cb22-253"><a href="#cb22-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-254"><a href="#cb22-254" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Scenario (SSP1--3)</span>
<span id="cb22-255"><a href="#cb22-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-256"><a href="#cb22-256" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predict SSP1</span></span>
<span id="cb22-257"><a href="#cb22-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-258"><a href="#cb22-258" aria-hidden="true" tabindex="-1"></a>Below is a loop (conceptual or in code) that:</span>
<span id="cb22-259"><a href="#cb22-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-260"><a href="#cb22-260" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Iterates through each time step of the SSP1 scenario</span>
<span id="cb22-261"><a href="#cb22-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-262"><a href="#cb22-262" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Updates coral biomass conditions</span>
<span id="cb22-263"><a href="#cb22-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-264"><a href="#cb22-264" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recalculates utilities and choice probabilities</span>
<span id="cb22-265"><a href="#cb22-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-266"><a href="#cb22-266" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimates welfare change (CV) for each grid-location pair</span>
<span id="cb22-267"><a href="#cb22-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-268"><a href="#cb22-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-269"><a href="#cb22-269" aria-hidden="true" tabindex="-1"></a><span class="do">### parameters</span></span>
<span id="cb22-270"><a href="#cb22-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-271"><a href="#cb22-271" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> m3<span class="sc">$</span>results[,<span class="dv">1</span>]</span>
<span id="cb22-272"><a href="#cb22-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-273"><a href="#cb22-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-274"><a href="#cb22-274" aria-hidden="true" tabindex="-1"></a><span class="do">### Considering a transfer to Oahu:</span></span>
<span id="cb22-275"><a href="#cb22-275" aria-hidden="true" tabindex="-1"></a>x1[<span class="fu">is.na</span>(x1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-276"><a href="#cb22-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-277"><a href="#cb22-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-278"><a href="#cb22-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-279"><a href="#cb22-279" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( x1<span class="sc">$</span>cost,x1<span class="sc">$</span>home, x1<span class="sc">$</span>coastal, x1<span class="sc">$</span>citypark, x1<span class="sc">$</span>trailall,</span>
<span id="cb22-280"><a href="#cb22-280" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>haleakala, x1<span class="sc">$</span>molokini, x1<span class="sc">$</span>parking, x1<span class="sc">$</span>showers,</span>
<span id="cb22-281"><a href="#cb22-281" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>lifeguard, x1<span class="sc">$</span>rock, x1<span class="sc">$</span>manmade, x1<span class="sc">$</span>beachmedium, x1<span class="sc">$</span>beachlarge, x1<span class="sc">$</span>surf,</span>
<span id="cb22-282"><a href="#cb22-282" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>swim, x1<span class="sc">$</span>snork, x1<span class="sc">$</span>res_fish_bio, x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>playground, x1<span class="sc">$</span>sports,</span>
<span id="cb22-283"><a href="#cb22-283" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>res_fish_bio)</span>
<span id="cb22-284"><a href="#cb22-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-285"><a href="#cb22-285" aria-hidden="true" tabindex="-1"></a>X0[<span class="fu">is.na</span>(X0)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-286"><a href="#cb22-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-287"><a href="#cb22-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-288"><a href="#cb22-288" aria-hidden="true" tabindex="-1"></a>xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb22-289"><a href="#cb22-289" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb22-290"><a href="#cb22-290" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb22-291"><a href="#cb22-291" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(final) &lt;- c("time10",  "time20" , "time30" , "time40")</span></span>
<span id="cb22-292"><a href="#cb22-292" aria-hidden="true" tabindex="-1"></a><span class="co">#this needs to be ran as a loop</span></span>
<span id="cb22-293"><a href="#cb22-293" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">82</span>) {</span>
<span id="cb22-294"><a href="#cb22-294" aria-hidden="true" tabindex="-1"></a>  xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb22-295"><a href="#cb22-295" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS <span class="ot">&lt;-</span> xsim<span class="sc">$</span>PNAS <span class="sc">*</span>xsim[,i]</span>
<span id="cb22-296"><a href="#cb22-296" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS[xsim<span class="sc">$</span>PNAS <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-297"><a href="#cb22-297" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-298"><a href="#cb22-298" aria-hidden="true" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( xsim<span class="sc">$</span>cost,xsim<span class="sc">$</span>home, xsim<span class="sc">$</span>coastal, xsim<span class="sc">$</span>citypark, xsim<span class="sc">$</span>trailall,</span>
<span id="cb22-299"><a href="#cb22-299" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>haleakala, xsim<span class="sc">$</span>molokini, xsim<span class="sc">$</span>parking, xsim<span class="sc">$</span>showers,</span>
<span id="cb22-300"><a href="#cb22-300" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>lifeguard, xsim<span class="sc">$</span>rock, xsim<span class="sc">$</span>manmade, xsim<span class="sc">$</span>beachmedium, xsim<span class="sc">$</span>beachlarge, xsim<span class="sc">$</span>surf,</span>
<span id="cb22-301"><a href="#cb22-301" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>swim, xsim<span class="sc">$</span>snork, xsim<span class="sc">$</span>res_fish_bio, xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>playground, xsim<span class="sc">$</span>sports,</span>
<span id="cb22-302"><a href="#cb22-302" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>res_fish_bio)</span>
<span id="cb22-303"><a href="#cb22-303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-304"><a href="#cb22-304" aria-hidden="true" tabindex="-1"></a>  X1[<span class="fu">is.na</span>(X1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-305"><a href="#cb22-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-306"><a href="#cb22-306" aria-hidden="true" tabindex="-1"></a>  <span class="do">### CALCULATION OF WTP FOR EACH GRID LOCATION</span></span>
<span id="cb22-307"><a href="#cb22-307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-308"><a href="#cb22-308" aria-hidden="true" tabindex="-1"></a>  wtpw <span class="ot">&lt;-</span> <span class="fu">quality.change</span>(<span class="at">beta =</span> beta, <span class="do">### parameters</span></span>
<span id="cb22-309"><a href="#cb22-309" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X0=</span>X0,     <span class="do">### X variables in the baseline</span></span>
<span id="cb22-310"><a href="#cb22-310" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X1 =</span> X1,   <span class="do">#### X variables in the scenario</span></span>
<span id="cb22-311"><a href="#cb22-311" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pid =</span> x1<span class="sc">$</span>km2_ID,    <span class="do">### ID of the 1km grid</span></span>
<span id="cb22-312"><a href="#cb22-312" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cost =</span><span class="dv">1</span>)       <span class="do">### column of the cost parameter in the X matrix</span></span>
<span id="cb22-313"><a href="#cb22-313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-314"><a href="#cb22-314" aria-hidden="true" tabindex="-1"></a>  <span class="do">### TOTAL WTP</span></span>
<span id="cb22-315"><a href="#cb22-315" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-316"><a href="#cb22-316" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span><span class="fu">merge</span>(wtpw,out, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">"id"</span>),<span class="at">by.y=</span><span class="fu">c</span>(<span class="st">"km2_ID"</span>))</span>
<span id="cb22-317"><a href="#cb22-317" aria-hidden="true" tabindex="-1"></a>  b<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb22-318"><a href="#cb22-318" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">=</span>b <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SSP1_block=</span><span class="fu">sum</span>(WTP <span class="sc">*</span> incometran_track<span class="sc">*</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>)</span>
<span id="cb22-319"><a href="#cb22-319" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-320"><a href="#cb22-320" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb22-321"><a href="#cb22-321" aria-hidden="true" tabindex="-1"></a>  all<span class="ot">=</span><span class="fu">rbind</span>(b,all)</span>
<span id="cb22-322"><a href="#cb22-322" aria-hidden="true" tabindex="-1"></a>  final<span class="ot">=</span><span class="fu">rbind</span>(a,final)</span>
<span id="cb22-323"><a href="#cb22-323" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-324"><a href="#cb22-324" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>final</span>
<span id="cb22-325"><a href="#cb22-325" aria-hidden="true" tabindex="-1"></a>all_df<span class="ot">=</span>all</span>
<span id="cb22-326"><a href="#cb22-326" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_df)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP1"</span></span>
<span id="cb22-327"><a href="#cb22-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-328"><a href="#cb22-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-329"><a href="#cb22-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-330"><a href="#cb22-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-331"><a href="#cb22-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-332"><a href="#cb22-332" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predict SSP2</span></span>
<span id="cb22-333"><a href="#cb22-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-334"><a href="#cb22-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-335"><a href="#cb22-335" aria-hidden="true" tabindex="-1"></a><span class="do">####This is for SSP2</span></span>
<span id="cb22-336"><a href="#cb22-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-337"><a href="#cb22-337" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">merge</span>(dist1, sites_join)</span>
<span id="cb22-338"><a href="#cb22-338" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>coastal[x1<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Home"</span>]<span class="ot">=</span><span class="dv">0</span> </span>
<span id="cb22-339"><a href="#cb22-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-340"><a href="#cb22-340" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="fu">merge</span>(SSP2, x1, <span class="at">by.x =</span> <span class="st">"polygon"</span>, <span class="at">by.y =</span> <span class="st">"Box_ID_2"</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-341"><a href="#cb22-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-342"><a href="#cb22-342" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>km2_ID,x1<span class="sc">$</span>siteID),]   <span class="do">## btw it is correct that the dim(x) is lower than dim(dist) because</span></span>
<span id="cb22-343"><a href="#cb22-343" aria-hidden="true" tabindex="-1"></a><span class="do">## I aggregated some sites</span></span>
<span id="cb22-344"><a href="#cb22-344" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(x1<span class="sc">$</span>siteID))</span>
<span id="cb22-345"><a href="#cb22-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-346"><a href="#cb22-346" aria-hidden="true" tabindex="-1"></a><span class="do">### FINISHED LOADING AND MERGING DATASETS </span><span class="al">###</span></span>
<span id="cb22-347"><a href="#cb22-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-348"><a href="#cb22-348" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(dist, pop, sitesjoin)</span></span>
<span id="cb22-349"><a href="#cb22-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-350"><a href="#cb22-350" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE TRAVEL COST ####</span></span>
<span id="cb22-351"><a href="#cb22-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-352"><a href="#cb22-352" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-353"><a href="#cb22-353" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="sc">+</span> <span class="dv">40</span>       <span class="do">## this sites needs 40min walking to be reached</span></span>
<span id="cb22-354"><a href="#cb22-354" aria-hidden="true" tabindex="-1"></a><span class="do">## Need to also do this for Hawaii</span></span>
<span id="cb22-355"><a href="#cb22-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-356"><a href="#cb22-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-357"><a href="#cb22-357" aria-hidden="true" tabindex="-1"></a><span class="do">### Change here for different fuel cost</span></span>
<span id="cb22-358"><a href="#cb22-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-359"><a href="#cb22-359" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>distance.meters<span class="sc">*</span><span class="fl">0.001</span> <span class="sc">*</span> (<span class="fl">0.20</span> <span class="sc">/</span> <span class="fl">1.5</span>   )               <span class="do">## fuel cost </span></span>
<span id="cb22-360"><a href="#cb22-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-361"><a href="#cb22-361" aria-hidden="true" tabindex="-1"></a><span class="do">## assumption on fuel cost:</span></span>
<span id="cb22-362"><a href="#cb22-362" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-363"><a href="#cb22-363" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 miles/gallon</span></span>
<span id="cb22-364"><a href="#cb22-364" aria-hidden="true" tabindex="-1"></a><span class="co"># $4.3/gallon</span></span>
<span id="cb22-365"><a href="#cb22-365" aria-hidden="true" tabindex="-1"></a><span class="co"># means $4.3 per 20 miles --&gt; 0.215 $/mile</span></span>
<span id="cb22-366"><a href="#cb22-366" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km --&gt; 6.2 miles --&gt; $1.33 travel cost per km</span></span>
<span id="cb22-367"><a href="#cb22-367" aria-hidden="true" tabindex="-1"></a><span class="co"># 10km * 0.20 / 1.5 = $1.33  so the values coincide with the cost used above.</span></span>
<span id="cb22-368"><a href="#cb22-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-369"><a href="#cb22-369" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">+</span> (x1<span class="sc">$</span>duration <span class="sc">/</span> <span class="dv">60</span>)<span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">24.14</span>    <span class="do">## add the value of time (assuming a 25$ per hour average wage rate)</span></span>
<span id="cb22-370"><a href="#cb22-370" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">*</span> <span class="dv">2</span>                          <span class="do">## the value for a return trip</span></span>
<span id="cb22-371"><a href="#cb22-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-372"><a href="#cb22-372" aria-hidden="true" tabindex="-1"></a><span class="do">#### put Molokini cost equal to the one of Makena Landing Beach Park + 100$ (cost of a snorkeling tour)</span></span>
<span id="cb22-373"><a href="#cb22-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-374"><a href="#cb22-374" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">388</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">359</span>] <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb22-375"><a href="#cb22-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-376"><a href="#cb22-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-377"><a href="#cb22-377" aria-hidden="true" tabindex="-1"></a><span class="do">### PREPARE DATA FOR PREDICTIONS </span></span>
<span id="cb22-378"><a href="#cb22-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-379"><a href="#cb22-379" aria-hidden="true" tabindex="-1"></a><span class="do">### parameters</span></span>
<span id="cb22-380"><a href="#cb22-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-381"><a href="#cb22-381" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> m3<span class="sc">$</span>results[,<span class="dv">1</span>]</span>
<span id="cb22-382"><a href="#cb22-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-383"><a href="#cb22-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-384"><a href="#cb22-384" aria-hidden="true" tabindex="-1"></a><span class="do">### Considering a transfer to Oahu:</span></span>
<span id="cb22-385"><a href="#cb22-385" aria-hidden="true" tabindex="-1"></a>x1[<span class="fu">is.na</span>(x1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-386"><a href="#cb22-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-387"><a href="#cb22-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-388"><a href="#cb22-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-389"><a href="#cb22-389" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( x1<span class="sc">$</span>cost,x1<span class="sc">$</span>home, x1<span class="sc">$</span>coastal, x1<span class="sc">$</span>citypark, x1<span class="sc">$</span>trailall,</span>
<span id="cb22-390"><a href="#cb22-390" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>haleakala, x1<span class="sc">$</span>molokini, x1<span class="sc">$</span>parking, x1<span class="sc">$</span>showers,</span>
<span id="cb22-391"><a href="#cb22-391" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>lifeguard, x1<span class="sc">$</span>rock, x1<span class="sc">$</span>manmade, x1<span class="sc">$</span>beachmedium, x1<span class="sc">$</span>beachlarge, x1<span class="sc">$</span>surf,</span>
<span id="cb22-392"><a href="#cb22-392" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>swim, x1<span class="sc">$</span>snork, x1<span class="sc">$</span>res_fish_bio, x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>playground, x1<span class="sc">$</span>sports,</span>
<span id="cb22-393"><a href="#cb22-393" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>res_fish_bio)</span>
<span id="cb22-394"><a href="#cb22-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-395"><a href="#cb22-395" aria-hidden="true" tabindex="-1"></a>X0[<span class="fu">is.na</span>(X0)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-396"><a href="#cb22-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-397"><a href="#cb22-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-398"><a href="#cb22-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-399"><a href="#cb22-399" aria-hidden="true" tabindex="-1"></a>xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb22-400"><a href="#cb22-400" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb22-401"><a href="#cb22-401" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb22-402"><a href="#cb22-402" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(final) &lt;- c("time10",  "time20" , "time30" , "time40")</span></span>
<span id="cb22-403"><a href="#cb22-403" aria-hidden="true" tabindex="-1"></a><span class="co">#this needs to be ran as a loop</span></span>
<span id="cb22-404"><a href="#cb22-404" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">83</span>) {</span>
<span id="cb22-405"><a href="#cb22-405" aria-hidden="true" tabindex="-1"></a>  xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb22-406"><a href="#cb22-406" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS <span class="ot">&lt;-</span> xsim<span class="sc">$</span>PNAS <span class="sc">*</span>xsim[,i]</span>
<span id="cb22-407"><a href="#cb22-407" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS[xsim<span class="sc">$</span>PNAS <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-408"><a href="#cb22-408" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-409"><a href="#cb22-409" aria-hidden="true" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( xsim<span class="sc">$</span>cost,xsim<span class="sc">$</span>home, xsim<span class="sc">$</span>coastal, xsim<span class="sc">$</span>citypark, xsim<span class="sc">$</span>trailall,</span>
<span id="cb22-410"><a href="#cb22-410" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>haleakala, xsim<span class="sc">$</span>molokini, xsim<span class="sc">$</span>parking, xsim<span class="sc">$</span>showers,</span>
<span id="cb22-411"><a href="#cb22-411" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>lifeguard, xsim<span class="sc">$</span>rock, xsim<span class="sc">$</span>manmade, xsim<span class="sc">$</span>beachmedium, xsim<span class="sc">$</span>beachlarge, xsim<span class="sc">$</span>surf,</span>
<span id="cb22-412"><a href="#cb22-412" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>swim, xsim<span class="sc">$</span>snork, xsim<span class="sc">$</span>res_fish_bio, xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>playground, xsim<span class="sc">$</span>sports,</span>
<span id="cb22-413"><a href="#cb22-413" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>res_fish_bio)</span>
<span id="cb22-414"><a href="#cb22-414" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-415"><a href="#cb22-415" aria-hidden="true" tabindex="-1"></a>  X1[<span class="fu">is.na</span>(X1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-416"><a href="#cb22-416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-417"><a href="#cb22-417" aria-hidden="true" tabindex="-1"></a>  <span class="do">### CALCULATION OF WTP FOR EACH GRID LOCATION</span></span>
<span id="cb22-418"><a href="#cb22-418" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-419"><a href="#cb22-419" aria-hidden="true" tabindex="-1"></a>  wtpw <span class="ot">&lt;-</span> <span class="fu">quality.change</span>(<span class="at">beta =</span> beta, <span class="do">### parameters</span></span>
<span id="cb22-420"><a href="#cb22-420" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X0=</span>X0,     <span class="do">### X variables in the baseline</span></span>
<span id="cb22-421"><a href="#cb22-421" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X1 =</span> X1,   <span class="do">#### X variables in the scenario</span></span>
<span id="cb22-422"><a href="#cb22-422" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pid =</span> x1<span class="sc">$</span>km2_ID,    <span class="do">### ID of the 1km grid</span></span>
<span id="cb22-423"><a href="#cb22-423" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cost =</span><span class="dv">1</span>)       <span class="do">### column of the cost parameter in the X matrix</span></span>
<span id="cb22-424"><a href="#cb22-424" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-425"><a href="#cb22-425" aria-hidden="true" tabindex="-1"></a>  <span class="do">### TOTAL WTP</span></span>
<span id="cb22-426"><a href="#cb22-426" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-427"><a href="#cb22-427" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span><span class="fu">merge</span>(wtpw,out, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">"id"</span>),<span class="at">by.y=</span><span class="fu">c</span>(<span class="st">"km2_ID"</span>))</span>
<span id="cb22-428"><a href="#cb22-428" aria-hidden="true" tabindex="-1"></a>  b<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb22-429"><a href="#cb22-429" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">=</span>b <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SSP2_block=</span><span class="fu">sum</span>(WTP <span class="sc">*</span> incometran_track<span class="sc">*</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>)</span>
<span id="cb22-430"><a href="#cb22-430" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-431"><a href="#cb22-431" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb22-432"><a href="#cb22-432" aria-hidden="true" tabindex="-1"></a>  all<span class="ot">=</span><span class="fu">rbind</span>(b,all)</span>
<span id="cb22-433"><a href="#cb22-433" aria-hidden="true" tabindex="-1"></a>  final<span class="ot">=</span><span class="fu">rbind</span>(a,final)</span>
<span id="cb22-434"><a href="#cb22-434" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-435"><a href="#cb22-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-436"><a href="#cb22-436" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">merge</span>(df,final, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-437"><a href="#cb22-437" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP2"</span></span>
<span id="cb22-438"><a href="#cb22-438" aria-hidden="true" tabindex="-1"></a>all_df<span class="ot">=</span><span class="fu">merge</span>(all_df, all, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-439"><a href="#cb22-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-440"><a href="#cb22-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-441"><a href="#cb22-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-442"><a href="#cb22-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-443"><a href="#cb22-443" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predict SSP3</span></span>
<span id="cb22-444"><a href="#cb22-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-445"><a href="#cb22-445" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-446"><a href="#cb22-446" aria-hidden="true" tabindex="-1"></a><span class="do">####This is for SSP3</span></span>
<span id="cb22-447"><a href="#cb22-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-448"><a href="#cb22-448" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">merge</span>(dist1, sites_join)</span>
<span id="cb22-449"><a href="#cb22-449" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>coastal[x1<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Home"</span>]<span class="ot">=</span><span class="dv">0</span> </span>
<span id="cb22-450"><a href="#cb22-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-451"><a href="#cb22-451" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="fu">merge</span>(SSP3, x1, <span class="at">by.x =</span> <span class="st">"polygon"</span>, <span class="at">by.y =</span> <span class="st">"Box_ID_2"</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-452"><a href="#cb22-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-453"><a href="#cb22-453" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x1[<span class="fu">order</span>(x1<span class="sc">$</span>km2_ID,x1<span class="sc">$</span>siteID),]   <span class="do">## btw it is correct that the dim(x) is lower than dim(dist) because</span></span>
<span id="cb22-454"><a href="#cb22-454" aria-hidden="true" tabindex="-1"></a><span class="do">## I aggregated some sites</span></span>
<span id="cb22-455"><a href="#cb22-455" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(x1<span class="sc">$</span>siteID))</span>
<span id="cb22-456"><a href="#cb22-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-457"><a href="#cb22-457" aria-hidden="true" tabindex="-1"></a><span class="do">### FINISHED LOADING AND MERGING DATASETS </span><span class="al">###</span></span>
<span id="cb22-458"><a href="#cb22-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-459"><a href="#cb22-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-460"><a href="#cb22-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-461"><a href="#cb22-461" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE TRAVEL COST ####</span></span>
<span id="cb22-462"><a href="#cb22-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-463"><a href="#cb22-463" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-464"><a href="#cb22-464" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>duration[ x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">351</span>] <span class="sc">+</span> <span class="dv">40</span>       <span class="do">## this sites needs 40min walking to be reached</span></span>
<span id="cb22-465"><a href="#cb22-465" aria-hidden="true" tabindex="-1"></a><span class="do">## Need to also do this for Hawaii</span></span>
<span id="cb22-466"><a href="#cb22-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-467"><a href="#cb22-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-468"><a href="#cb22-468" aria-hidden="true" tabindex="-1"></a><span class="do">### Change here for different fuel cost</span></span>
<span id="cb22-469"><a href="#cb22-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-470"><a href="#cb22-470" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>distance.meters<span class="sc">*</span><span class="fl">0.001</span> <span class="sc">*</span> (<span class="fl">0.20</span> <span class="sc">/</span> <span class="fl">1.5</span>   )               <span class="do">## fuel cost </span></span>
<span id="cb22-471"><a href="#cb22-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-472"><a href="#cb22-472" aria-hidden="true" tabindex="-1"></a><span class="do">## assumption on fuel cost:</span></span>
<span id="cb22-473"><a href="#cb22-473" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb22-474"><a href="#cb22-474" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 miles/gallon</span></span>
<span id="cb22-475"><a href="#cb22-475" aria-hidden="true" tabindex="-1"></a><span class="co"># $4.3/gallon</span></span>
<span id="cb22-476"><a href="#cb22-476" aria-hidden="true" tabindex="-1"></a><span class="co"># means $4.3 per 20 miles --&gt; 0.215 $/mile</span></span>
<span id="cb22-477"><a href="#cb22-477" aria-hidden="true" tabindex="-1"></a><span class="co"># 10 km --&gt; 6.2 miles --&gt; $1.33 travel cost per km</span></span>
<span id="cb22-478"><a href="#cb22-478" aria-hidden="true" tabindex="-1"></a><span class="co"># 10km * 0.20 / 1.5 = $1.33  so the values coincide with the cost used above.</span></span>
<span id="cb22-479"><a href="#cb22-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-480"><a href="#cb22-480" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">+</span> (x1<span class="sc">$</span>duration <span class="sc">/</span> <span class="dv">60</span>)<span class="sc">*</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">24.14</span>    <span class="do">## add the value of time (assuming a 25$ per hour average wage rate)</span></span>
<span id="cb22-481"><a href="#cb22-481" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost <span class="sc">*</span> <span class="dv">2</span>                          <span class="do">## the value for a return trip</span></span>
<span id="cb22-482"><a href="#cb22-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-483"><a href="#cb22-483" aria-hidden="true" tabindex="-1"></a><span class="do">#### put Molokini cost equal to the one of Makena Landing Beach Park + 100$ (cost of a snorkeling tour)</span></span>
<span id="cb22-484"><a href="#cb22-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-485"><a href="#cb22-485" aria-hidden="true" tabindex="-1"></a>x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">388</span>] <span class="ot">&lt;-</span> x1<span class="sc">$</span>cost[x1<span class="sc">$</span>siteID <span class="sc">==</span> <span class="dv">359</span>] <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb22-486"><a href="#cb22-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-487"><a href="#cb22-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-488"><a href="#cb22-488" aria-hidden="true" tabindex="-1"></a><span class="do">### PREPARE DATA FOR PREDICTIONS </span></span>
<span id="cb22-489"><a href="#cb22-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-490"><a href="#cb22-490" aria-hidden="true" tabindex="-1"></a><span class="do">### parameters</span></span>
<span id="cb22-491"><a href="#cb22-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-492"><a href="#cb22-492" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> m3<span class="sc">$</span>results[,<span class="dv">1</span>]</span>
<span id="cb22-493"><a href="#cb22-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-494"><a href="#cb22-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-495"><a href="#cb22-495" aria-hidden="true" tabindex="-1"></a><span class="do">### Considering a transfer to Oahu:</span></span>
<span id="cb22-496"><a href="#cb22-496" aria-hidden="true" tabindex="-1"></a>x1[<span class="fu">is.na</span>(x1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-497"><a href="#cb22-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-498"><a href="#cb22-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-499"><a href="#cb22-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-500"><a href="#cb22-500" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( x1<span class="sc">$</span>cost,x1<span class="sc">$</span>home, x1<span class="sc">$</span>coastal, x1<span class="sc">$</span>citypark, x1<span class="sc">$</span>trailall,</span>
<span id="cb22-501"><a href="#cb22-501" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>haleakala, x1<span class="sc">$</span>molokini, x1<span class="sc">$</span>parking, x1<span class="sc">$</span>showers,</span>
<span id="cb22-502"><a href="#cb22-502" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>lifeguard, x1<span class="sc">$</span>rock, x1<span class="sc">$</span>manmade, x1<span class="sc">$</span>beachmedium, x1<span class="sc">$</span>beachlarge, x1<span class="sc">$</span>surf,</span>
<span id="cb22-503"><a href="#cb22-503" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>swim, x1<span class="sc">$</span>snork, x1<span class="sc">$</span>res_fish_bio, x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>playground, x1<span class="sc">$</span>sports,</span>
<span id="cb22-504"><a href="#cb22-504" aria-hidden="true" tabindex="-1"></a>             x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>PNAS, x1<span class="sc">$</span>snork<span class="sc">*</span>x1<span class="sc">$</span>res_fish_bio)</span>
<span id="cb22-505"><a href="#cb22-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-506"><a href="#cb22-506" aria-hidden="true" tabindex="-1"></a>X0[<span class="fu">is.na</span>(X0)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-507"><a href="#cb22-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-508"><a href="#cb22-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-509"><a href="#cb22-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-510"><a href="#cb22-510" aria-hidden="true" tabindex="-1"></a>xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb22-511"><a href="#cb22-511" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb22-512"><a href="#cb22-512" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span><span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb22-513"><a href="#cb22-513" aria-hidden="true" tabindex="-1"></a><span class="co">#colnames(final) &lt;- c("time10",  "time20" , "time30" , "time40")</span></span>
<span id="cb22-514"><a href="#cb22-514" aria-hidden="true" tabindex="-1"></a><span class="co">#this needs to be ran as a loop</span></span>
<span id="cb22-515"><a href="#cb22-515" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">83</span>) {</span>
<span id="cb22-516"><a href="#cb22-516" aria-hidden="true" tabindex="-1"></a>  xsim <span class="ot">&lt;-</span> x1</span>
<span id="cb22-517"><a href="#cb22-517" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS <span class="ot">&lt;-</span> xsim<span class="sc">$</span>PNAS <span class="sc">*</span>xsim[,i]</span>
<span id="cb22-518"><a href="#cb22-518" aria-hidden="true" tabindex="-1"></a>  xsim<span class="sc">$</span>PNAS[xsim<span class="sc">$</span>PNAS <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-519"><a href="#cb22-519" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-520"><a href="#cb22-520" aria-hidden="true" tabindex="-1"></a>  X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>( xsim<span class="sc">$</span>cost,xsim<span class="sc">$</span>home, xsim<span class="sc">$</span>coastal, xsim<span class="sc">$</span>citypark, xsim<span class="sc">$</span>trailall,</span>
<span id="cb22-521"><a href="#cb22-521" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>haleakala, xsim<span class="sc">$</span>molokini, xsim<span class="sc">$</span>parking, xsim<span class="sc">$</span>showers,</span>
<span id="cb22-522"><a href="#cb22-522" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>lifeguard, xsim<span class="sc">$</span>rock, xsim<span class="sc">$</span>manmade, xsim<span class="sc">$</span>beachmedium, xsim<span class="sc">$</span>beachlarge, xsim<span class="sc">$</span>surf,</span>
<span id="cb22-523"><a href="#cb22-523" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>swim, xsim<span class="sc">$</span>snork, xsim<span class="sc">$</span>res_fish_bio, xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>playground, xsim<span class="sc">$</span>sports,</span>
<span id="cb22-524"><a href="#cb22-524" aria-hidden="true" tabindex="-1"></a>               xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>PNAS, xsim<span class="sc">$</span>snork<span class="sc">*</span>xsim<span class="sc">$</span>res_fish_bio)</span>
<span id="cb22-525"><a href="#cb22-525" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-526"><a href="#cb22-526" aria-hidden="true" tabindex="-1"></a>  X1[<span class="fu">is.na</span>(X1)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-527"><a href="#cb22-527" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-528"><a href="#cb22-528" aria-hidden="true" tabindex="-1"></a>  <span class="do">### CALCULATION OF WTP FOR EACH GRID LOCATION</span></span>
<span id="cb22-529"><a href="#cb22-529" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-530"><a href="#cb22-530" aria-hidden="true" tabindex="-1"></a>  wtpw <span class="ot">&lt;-</span> <span class="fu">quality.change</span>(<span class="at">beta =</span> beta, <span class="do">### parameters</span></span>
<span id="cb22-531"><a href="#cb22-531" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X0=</span>X0,     <span class="do">### X variables in the baseline</span></span>
<span id="cb22-532"><a href="#cb22-532" aria-hidden="true" tabindex="-1"></a>                         <span class="at">X1 =</span> X1,   <span class="do">#### X variables in the scenario</span></span>
<span id="cb22-533"><a href="#cb22-533" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pid =</span> x1<span class="sc">$</span>km2_ID,    <span class="do">### ID of the 1km grid</span></span>
<span id="cb22-534"><a href="#cb22-534" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cost =</span><span class="dv">1</span>)       <span class="do">### column of the cost parameter in the X matrix</span></span>
<span id="cb22-535"><a href="#cb22-535" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-536"><a href="#cb22-536" aria-hidden="true" tabindex="-1"></a>  <span class="do">### TOTAL WTP</span></span>
<span id="cb22-537"><a href="#cb22-537" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-538"><a href="#cb22-538" aria-hidden="true" tabindex="-1"></a>  b<span class="ot">=</span><span class="fu">merge</span>(wtpw,out, <span class="at">by.x=</span><span class="fu">c</span>(<span class="st">"id"</span>),<span class="at">by.y=</span><span class="fu">c</span>(<span class="st">"km2_ID"</span>))</span>
<span id="cb22-539"><a href="#cb22-539" aria-hidden="true" tabindex="-1"></a>  b<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb22-540"><a href="#cb22-540" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">=</span>b <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">SSP3_block=</span><span class="fu">sum</span>(WTP <span class="sc">*</span> incometran_track<span class="sc">*</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>)</span>
<span id="cb22-541"><a href="#cb22-541" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-542"><a href="#cb22-542" aria-hidden="true" tabindex="-1"></a>  a<span class="sc">$</span>time<span class="ot">=</span>i</span>
<span id="cb22-543"><a href="#cb22-543" aria-hidden="true" tabindex="-1"></a>  all<span class="ot">=</span><span class="fu">rbind</span>(b,all)</span>
<span id="cb22-544"><a href="#cb22-544" aria-hidden="true" tabindex="-1"></a>  final<span class="ot">=</span><span class="fu">rbind</span>(a,final)</span>
<span id="cb22-545"><a href="#cb22-545" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-546"><a href="#cb22-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-547"><a href="#cb22-547" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">merge</span>(df,final, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-548"><a href="#cb22-548" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP3"</span></span>
<span id="cb22-549"><a href="#cb22-549" aria-hidden="true" tabindex="-1"></a>all_df<span class="ot">=</span><span class="fu">merge</span>(all_df, all, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-550"><a href="#cb22-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-551"><a href="#cb22-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-552"><a href="#cb22-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-553"><a href="#cb22-553" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Aggregation</span></span>
<span id="cb22-554"><a href="#cb22-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-555"><a href="#cb22-555" aria-hidden="true" tabindex="-1"></a>Two datasets were created in the prediction modeling.</span>
<span id="cb22-556"><a href="#cb22-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-557"><a href="#cb22-557" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Aggregated Totals by population and income weighted by Island Each Year</span>
<span id="cb22-558"><a href="#cb22-558" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Raw Welfare Predictions per KM Grid</span>
<span id="cb22-559"><a href="#cb22-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-560"><a href="#cb22-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-561"><a href="#cb22-561" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP1_TotalWTP<span class="ot">=</span>(all_df<span class="sc">$</span>SSP1<span class="sc">*</span>all_df<span class="sc">$</span>incometran_track<span class="sc">*</span>all_df<span class="sc">$</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>) </span>
<span id="cb22-562"><a href="#cb22-562" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP2_TotalWTP<span class="ot">=</span>(all_df<span class="sc">$</span>SSP2<span class="sc">*</span>all_df<span class="sc">$</span>incometran_track<span class="sc">*</span>all_df<span class="sc">$</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>) </span>
<span id="cb22-563"><a href="#cb22-563" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP3_TotalWTP<span class="ot">=</span>(all_df<span class="sc">$</span>SSP3<span class="sc">*</span>all_df<span class="sc">$</span>incometran_track<span class="sc">*</span>all_df<span class="sc">$</span>grid_km_censusblock_Pop18_densityKM <span class="sc">*</span> <span class="dv">365</span>) </span>
<span id="cb22-564"><a href="#cb22-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-565"><a href="#cb22-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-566"><a href="#cb22-566" aria-hidden="true" tabindex="-1"></a>wtpssp1_total<span class="ot">=</span>all_df <span class="sc">%&gt;%</span></span>
<span id="cb22-567"><a href="#cb22-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year<span class="sc">==</span><span class="dv">2030</span> <span class="sc">|</span> Year<span class="sc">==</span><span class="dv">2050</span> <span class="sc">|</span> Year<span class="sc">==</span><span class="dv">2100</span>)</span>
<span id="cb22-568"><a href="#cb22-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-569"><a href="#cb22-569" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> wtpssp1_total <span class="sc">%&gt;%</span></span>
<span id="cb22-570"><a href="#cb22-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"SSP"</span>),</span>
<span id="cb22-571"><a href="#cb22-571" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"SSP_Var"</span>,</span>
<span id="cb22-572"><a href="#cb22-572" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb22-573"><a href="#cb22-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-574"><a href="#cb22-574" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create wide column names with Year info</span></span>
<span id="cb22-575"><a href="#cb22-575" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb22-576"><a href="#cb22-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">column_name =</span> <span class="fu">paste0</span>(<span class="st">"year_"</span>, Year, <span class="st">"_"</span>, SSP_Var))</span>
<span id="cb22-577"><a href="#cb22-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-578"><a href="#cb22-578" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Pivot wider using those column names</span></span>
<span id="cb22-579"><a href="#cb22-579" aria-hidden="true" tabindex="-1"></a>df_wide <span class="ot">&lt;-</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb22-580"><a href="#cb22-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, column_name, Value) <span class="sc">%&gt;%</span></span>
<span id="cb22-581"><a href="#cb22-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> column_name, <span class="at">values_from =</span> Value)</span>
<span id="cb22-582"><a href="#cb22-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-583"><a href="#cb22-583" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_wide, <span class="at">file=</span><span class="st">"allssps_islands.csv"</span>)</span>
<span id="cb22-584"><a href="#cb22-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-585"><a href="#cb22-585" aria-hidden="true" tabindex="-1"></a>coral<span class="ot">=</span>SSP1[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">32</span>,<span class="dv">82</span>)]</span>
<span id="cb22-586"><a href="#cb22-586" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP1_2030"</span></span>
<span id="cb22-587"><a href="#cb22-587" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP1_2050"</span></span>
<span id="cb22-588"><a href="#cb22-588" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">"SSP1_2100"</span></span>
<span id="cb22-589"><a href="#cb22-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-590"><a href="#cb22-590" aria-hidden="true" tabindex="-1"></a>coral1<span class="ot">=</span>SSP2[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">32</span>,<span class="dv">82</span>)]</span>
<span id="cb22-591"><a href="#cb22-591" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP2_2030"</span></span>
<span id="cb22-592"><a href="#cb22-592" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP2_2050"</span></span>
<span id="cb22-593"><a href="#cb22-593" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">"SSP2_2100"</span></span>
<span id="cb22-594"><a href="#cb22-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-595"><a href="#cb22-595" aria-hidden="true" tabindex="-1"></a>coral<span class="ot">=</span><span class="fu">merge</span>(coral,coral1)</span>
<span id="cb22-596"><a href="#cb22-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-597"><a href="#cb22-597" aria-hidden="true" tabindex="-1"></a>coral1<span class="ot">=</span>SSP3[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">32</span>,<span class="dv">82</span>)]</span>
<span id="cb22-598"><a href="#cb22-598" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">2</span>]<span class="ot">=</span><span class="st">"SSP3_2030"</span></span>
<span id="cb22-599"><a href="#cb22-599" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP3_2050"</span></span>
<span id="cb22-600"><a href="#cb22-600" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coral1)[<span class="dv">4</span>]<span class="ot">=</span><span class="st">"SSP3_2100"</span></span>
<span id="cb22-601"><a href="#cb22-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-602"><a href="#cb22-602" aria-hidden="true" tabindex="-1"></a>coral<span class="ot">=</span><span class="fu">merge</span>(coral,coral1)</span>
<span id="cb22-603"><a href="#cb22-603" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(coral, <span class="at">file=</span><span class="st">"coral_new.csv"</span>)</span>
<span id="cb22-604"><a href="#cb22-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-605"><a href="#cb22-605" aria-hidden="true" tabindex="-1"></a>df1<span class="ot">=</span><span class="fu">gather</span>(df, condition, wtp, SSP1_block<span class="sc">:</span>SSP3_block, <span class="at">factor_key=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-606"><a href="#cb22-606" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>condition<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"_block"</span>, <span class="st">""</span>, df1<span class="sc">$</span>condition)</span>
<span id="cb22-607"><a href="#cb22-607" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Kauai"</span>, <span class="st">"Kauaʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb22-608"><a href="#cb22-608" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Molokai"</span>, <span class="st">"Molokaʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb22-609"><a href="#cb22-609" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Oahu"</span>, <span class="st">"Oʻahu"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb22-610"><a href="#cb22-610" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Hawaii"</span>, <span class="st">"Hawaiʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb22-611"><a href="#cb22-611" aria-hidden="true" tabindex="-1"></a>df1<span class="sc">$</span>island<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"Lanai"</span>, <span class="st">"Lānaʻi"</span>, df1<span class="sc">$</span>island)</span>
<span id="cb22-612"><a href="#cb22-612" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df1, <span class="at">file=</span><span class="st">"allssps_islands.csv"</span>)</span>
<span id="cb22-613"><a href="#cb22-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-614"><a href="#cb22-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-615"><a href="#cb22-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-616"><a href="#cb22-616" aria-hidden="true" tabindex="-1"></a><span class="fu">### Across Island aggregation</span></span>
<span id="cb22-617"><a href="#cb22-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-618"><a href="#cb22-618" aria-hidden="true" tabindex="-1"></a><span class="fu">### Across-Island Aggregation of Welfare Loss</span></span>
<span id="cb22-619"><a href="#cb22-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-620"><a href="#cb22-620" aria-hidden="true" tabindex="-1"></a>This code snippet produces a projected summary table of total welfare loss by island, under each scenario (SSP1--SSP3). The results are aggregated over time and space, incorporating:</span>
<span id="cb22-621"><a href="#cb22-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-622"><a href="#cb22-622" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Annual compensating variation (CV) estimates at the grid level</span>
<span id="cb22-623"><a href="#cb22-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-624"><a href="#cb22-624" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Population projections for the state of Hawai\'i under SSP1--SSP3, used to scale welfare impacts</span>
<span id="cb22-625"><a href="#cb22-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-626"><a href="#cb22-626" aria-hidden="true" tabindex="-1"></a>    Two discounting frameworks:</span>
<span id="cb22-627"><a href="#cb22-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-628"><a href="#cb22-628" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A standard constant discount rate (e.g., circular A-4 rate, typically 3%)</span>
<span id="cb22-629"><a href="#cb22-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-630"><a href="#cb22-630" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A pluralistic (declining or hyperbolic) discount rate, reflecting alternative time preferences in environmental valuation</span>
<span id="cb22-631"><a href="#cb22-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-632"><a href="#cb22-632" aria-hidden="true" tabindex="-1"></a>These discounted totals provide a long-term estimate of the economic cost of environmental degradation (via coral biomass loss) under different future pathways. The final output summarizes welfare changes per island, scenario, and discounting method, supporting policy evaluation and prioritization.</span>
<span id="cb22-633"><a href="#cb22-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-634"><a href="#cb22-634" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/islandgraphpluristic_new.png)</span></span>
<span id="cb22-635"><a href="#cb22-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-636"><a href="#cb22-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-637"><a href="#cb22-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-638"><a href="#cb22-638" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb22-639"><a href="#cb22-639" aria-hidden="true" tabindex="-1"></a>allssps_islands <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/CR/codedata/allssps_islands.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-640"><a href="#cb22-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"..."</span>))</span>
<span id="cb22-641"><a href="#cb22-641" aria-hidden="true" tabindex="-1"></a>                              </span>
<span id="cb22-642"><a href="#cb22-642" aria-hidden="true" tabindex="-1"></a>allssps_islandspop <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"allssps_islands.xlsx"</span>,</span>
<span id="cb22-643"><a href="#cb22-643" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">sheet =</span> <span class="st">"pop"</span>)</span>
<span id="cb22-644"><a href="#cb22-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-645"><a href="#cb22-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-646"><a href="#cb22-646" aria-hidden="true" tabindex="-1"></a>allssps_islandspop<span class="ot">=</span><span class="fu">gather</span>(allssps_islandspop,  condition, pop, SSP1<span class="sc">:</span>SSP3, <span class="at">factor_key=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-647"><a href="#cb22-647" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="ot">=</span><span class="fu">merge</span>(allssps_islands,allssps_islandspop)</span>
<span id="cb22-648"><a href="#cb22-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-649"><a href="#cb22-649" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb22-650"><a href="#cb22-650" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV[<span class="fu">which</span>(allssps_islands<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">2020</span>)]<span class="ot">=</span>.<span class="dv">02</span></span>
<span id="cb22-651"><a href="#cb22-651" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV[<span class="fu">which</span>(allssps_islands<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">2079</span>)]<span class="ot">=</span>.<span class="dv">019</span></span>
<span id="cb22-652"><a href="#cb22-652" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV[<span class="fu">which</span>(allssps_islands<span class="sc">$</span>Year<span class="sc">&gt;</span><span class="dv">2094</span>)]<span class="ot">=</span>.<span class="dv">018</span></span>
<span id="cb22-653"><a href="#cb22-653" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>time_step <span class="ot">&lt;-</span> allssps_islands<span class="sc">$</span>Year <span class="sc">-</span> <span class="dv">2020</span></span>
<span id="cb22-654"><a href="#cb22-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-655"><a href="#cb22-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-656"><a href="#cb22-656" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP<span class="ot">=</span>allssps_islands<span class="sc">$</span>wtp<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>allssps_islands<span class="sc">$</span>NPV)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb22-657"><a href="#cb22-657" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Pop<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>allssps_islands<span class="sc">$</span>NPV)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb22-658"><a href="#cb22-658" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">4</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="dv">0</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">1</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">3</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.03</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.1</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb22-659"><a href="#cb22-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-660"><a href="#cb22-660" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic2<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">4</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+-</span>.<span class="dv">01</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">1</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">3</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.01</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step<span class="sc">+</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop<span class="sc">*</span>.<span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.5</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb22-661"><a href="#cb22-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-662"><a href="#cb22-662" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Lane<span class="ot">=</span>(allssps_islands<span class="sc">$</span>wtp<span class="sc">*</span>allssps_islands<span class="sc">$</span>pop)<span class="sc">/</span>(<span class="dv">1</span><span class="fl">+.03</span>)<span class="sc">^</span>allssps_islands<span class="sc">$</span>time_step</span>
<span id="cb22-663"><a href="#cb22-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-664"><a href="#cb22-664" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic2<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic2<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb22-665"><a href="#cb22-665" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Lane<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_Lane<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb22-666"><a href="#cb22-666" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_pluristic<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb22-667"><a href="#cb22-667" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb22-668"><a href="#cb22-668" aria-hidden="true" tabindex="-1"></a>allssps_islands<span class="sc">$</span>NPV_WTP_Pop<span class="ot">=</span>allssps_islands<span class="sc">$</span>NPV_WTP_Pop<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb22-669"><a href="#cb22-669" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(allssps_islands)[<span class="dv">3</span>]<span class="ot">=</span><span class="st">"SSP Scenario"</span></span>
<span id="cb22-670"><a href="#cb22-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-671"><a href="#cb22-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-672"><a href="#cb22-672" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(allssps_islands, <span class="fu">aes</span>(<span class="at">x =</span> Year)) <span class="sc">+</span></span>
<span id="cb22-673"><a href="#cb22-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> NPV_WTP_Pop, <span class="at">color =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>, <span class="at">group =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb22-674"><a href="#cb22-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> NPV_WTP_pluristic, <span class="at">color =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>, <span class="at">group =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb22-675"><a href="#cb22-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb22-676"><a href="#cb22-676" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> NPV_WTP_pluristic, <span class="at">ymax =</span> NPV_WTP_Pop, <span class="at">fill =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>, <span class="at">group =</span> <span class="st">`</span><span class="at">SSP Scenario</span><span class="st">`</span>),</span>
<span id="cb22-677"><a href="#cb22-677" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">0</span></span>
<span id="cb22-678"><a href="#cb22-678" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-679"><a href="#cb22-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> group.colors) <span class="sc">+</span></span>
<span id="cb22-680"><a href="#cb22-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> group.colors) <span class="sc">+</span></span>
<span id="cb22-681"><a href="#cb22-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-682"><a href="#cb22-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-683"><a href="#cb22-683" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times New Roman"</span>),</span>
<span id="cb22-684"><a href="#cb22-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-685"><a href="#cb22-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb22-686"><a href="#cb22-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>)</span>
<span id="cb22-687"><a href="#cb22-687" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-688"><a href="#cb22-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb22-689"><a href="#cb22-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Thousands Dollars"</span>) <span class="sc">+</span></span>
<span id="cb22-690"><a href="#cb22-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Projected Annual Welfare Impacts (in Thousands Dollars)"</span>) <span class="sc">+</span></span>
<span id="cb22-691"><a href="#cb22-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> <span class="fu">factor</span>(island, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Lānaʻi"</span>, <span class="st">"Molokaʻi"</span>, <span class="st">"Kauaʻi"</span>, <span class="st">"Hawaiʻi"</span>, <span class="st">"Maui"</span>, <span class="st">"Oʻahu"</span>)),</span>
<span id="cb22-692"><a href="#cb22-692" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb22-693"><a href="#cb22-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-694"><a href="#cb22-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-695"><a href="#cb22-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-696"><a href="#cb22-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-697"><a href="#cb22-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-698"><a href="#cb22-698" aria-hidden="true" tabindex="-1"></a><span class="fu">### Snap Shot within Island</span></span>
<span id="cb22-699"><a href="#cb22-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-700"><a href="#cb22-700" aria-hidden="true" tabindex="-1"></a>The raw welfare estimates generated in previous steps are not yet adjusted for differences in income levels or population density. The next code snippet computes total willingness to pay (WTP) by:</span>
<span id="cb22-701"><a href="#cb22-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-702"><a href="#cb22-702" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Aggregating individual welfare estimates by income tract and grid cell</span>
<span id="cb22-703"><a href="#cb22-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-704"><a href="#cb22-704" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Weighting by local population to reflect the total affected individuals</span>
<span id="cb22-705"><a href="#cb22-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-706"><a href="#cb22-706" aria-hidden="true" tabindex="-1"></a>This adjusted dataset is especially useful for understanding distributional impacts of environmental change and for producing spatially explicit visualizations of welfare loss.</span>
<span id="cb22-707"><a href="#cb22-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-708"><a href="#cb22-708" aria-hidden="true" tabindex="-1"></a>**In the paper we present 2030, 2050, 2100 but here we have also 2075**</span>
<span id="cb22-709"><a href="#cb22-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-710"><a href="#cb22-710" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/maps.png)</span></span>
<span id="cb22-711"><a href="#cb22-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-712"><a href="#cb22-712" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-713"><a href="#cb22-713" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb22-714"><a href="#cb22-714" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the cutpoints for 7 intervals</span></span>
<span id="cb22-715"><a href="#cb22-715" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/CR/codedata/all_grids.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb22-716"><a href="#cb22-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"..."</span>))</span>
<span id="cb22-717"><a href="#cb22-717" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> all_df <span class="sc">%&gt;%</span></span>
<span id="cb22-718"><a href="#cb22-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SSP1_WTP_bin =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-719"><a href="#cb22-719" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e6</span>         <span class="sc">~</span> <span class="st">"≤ -1M"</span>,</span>
<span id="cb22-720"><a href="#cb22-720" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e5</span>         <span class="sc">~</span> <span class="st">"-1M to -100K"</span>,</span>
<span id="cb22-721"><a href="#cb22-721" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e3</span>         <span class="sc">~</span> <span class="st">"-100K to -1K"</span>,</span>
<span id="cb22-722"><a href="#cb22-722" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">100</span>         <span class="sc">~</span> <span class="st">"-1K to -100"</span>,</span>
<span id="cb22-723"><a href="#cb22-723" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;</span> <span class="dv">0</span>             <span class="sc">~</span> <span class="st">"-100 to 0"</span>,</span>
<span id="cb22-724"><a href="#cb22-724" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">==</span> <span class="dv">0</span>            <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb22-725"><a href="#cb22-725" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="dv">100</span>          <span class="sc">~</span> <span class="st">"0 to 100"</span>,</span>
<span id="cb22-726"><a href="#cb22-726" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e3</span>          <span class="sc">~</span> <span class="st">"100 to 1K"</span>,</span>
<span id="cb22-727"><a href="#cb22-727" aria-hidden="true" tabindex="-1"></a>    SSP1_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e4</span>          <span class="sc">~</span> <span class="st">"1K to 10K"</span>,</span>
<span id="cb22-728"><a href="#cb22-728" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                          <span class="sc">~</span> <span class="st">"&gt; 10K"</span></span>
<span id="cb22-729"><a href="#cb22-729" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-730"><a href="#cb22-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-731"><a href="#cb22-731" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> all_df <span class="sc">%&gt;%</span></span>
<span id="cb22-732"><a href="#cb22-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SSP2_WTP_bin =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-733"><a href="#cb22-733" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e6</span>         <span class="sc">~</span> <span class="st">"≤ -1M"</span>,</span>
<span id="cb22-734"><a href="#cb22-734" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e5</span>         <span class="sc">~</span> <span class="st">"-1M to -100K"</span>,</span>
<span id="cb22-735"><a href="#cb22-735" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e3</span>         <span class="sc">~</span> <span class="st">"-100K to -1K"</span>,</span>
<span id="cb22-736"><a href="#cb22-736" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">100</span>         <span class="sc">~</span> <span class="st">"-1K to -100"</span>,</span>
<span id="cb22-737"><a href="#cb22-737" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;</span> <span class="dv">0</span>             <span class="sc">~</span> <span class="st">"-100 to 0"</span>,</span>
<span id="cb22-738"><a href="#cb22-738" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">==</span> <span class="dv">0</span>            <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb22-739"><a href="#cb22-739" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="dv">100</span>          <span class="sc">~</span> <span class="st">"0 to 100"</span>,</span>
<span id="cb22-740"><a href="#cb22-740" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e3</span>          <span class="sc">~</span> <span class="st">"100 to 1K"</span>,</span>
<span id="cb22-741"><a href="#cb22-741" aria-hidden="true" tabindex="-1"></a>    SSP2_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e4</span>          <span class="sc">~</span> <span class="st">"1K to 10K"</span>,</span>
<span id="cb22-742"><a href="#cb22-742" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                          <span class="sc">~</span> <span class="st">"&gt; 10K"</span></span>
<span id="cb22-743"><a href="#cb22-743" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-744"><a href="#cb22-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-745"><a href="#cb22-745" aria-hidden="true" tabindex="-1"></a>all_df <span class="ot">&lt;-</span> all_df <span class="sc">%&gt;%</span></span>
<span id="cb22-746"><a href="#cb22-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SSP3_WTP_bin =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-747"><a href="#cb22-747" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e6</span>         <span class="sc">~</span> <span class="st">"≤ -1M"</span>,</span>
<span id="cb22-748"><a href="#cb22-748" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e5</span>         <span class="sc">~</span> <span class="st">"-1M to -100K"</span>,</span>
<span id="cb22-749"><a href="#cb22-749" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">1e3</span>         <span class="sc">~</span> <span class="st">"-100K to -1K"</span>,</span>
<span id="cb22-750"><a href="#cb22-750" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">100</span>         <span class="sc">~</span> <span class="st">"-1K to -100"</span>,</span>
<span id="cb22-751"><a href="#cb22-751" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;</span> <span class="dv">0</span>             <span class="sc">~</span> <span class="st">"-100 to 0"</span>,</span>
<span id="cb22-752"><a href="#cb22-752" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">==</span> <span class="dv">0</span>            <span class="sc">~</span> <span class="st">"0"</span>,</span>
<span id="cb22-753"><a href="#cb22-753" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="dv">100</span>          <span class="sc">~</span> <span class="st">"0 to 100"</span>,</span>
<span id="cb22-754"><a href="#cb22-754" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e3</span>          <span class="sc">~</span> <span class="st">"100 to 1K"</span>,</span>
<span id="cb22-755"><a href="#cb22-755" aria-hidden="true" tabindex="-1"></a>    SSP3_TotalWTP <span class="sc">&lt;=</span> <span class="fl">1e4</span>          <span class="sc">~</span> <span class="st">"1K to 10K"</span>,</span>
<span id="cb22-756"><a href="#cb22-756" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                          <span class="sc">~</span> <span class="st">"&gt; 10K"</span></span>
<span id="cb22-757"><a href="#cb22-757" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-758"><a href="#cb22-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-759"><a href="#cb22-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-760"><a href="#cb22-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-761"><a href="#cb22-761" aria-hidden="true" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-762"><a href="#cb22-762" aria-hidden="true" tabindex="-1"></a>  <span class="st">"≤ -1M"</span>         <span class="ot">=</span> <span class="st">"darkred"</span>,</span>
<span id="cb22-763"><a href="#cb22-763" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1M to -100K"</span>  <span class="ot">=</span> <span class="st">"brown"</span>,</span>
<span id="cb22-764"><a href="#cb22-764" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100K to -1K"</span>  <span class="ot">=</span> <span class="st">"lightcoral"</span>,</span>
<span id="cb22-765"><a href="#cb22-765" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1K to -100"</span>   <span class="ot">=</span> <span class="st">"pink"</span>,</span>
<span id="cb22-766"><a href="#cb22-766" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100 to 0"</span>     <span class="ot">=</span> <span class="st">"mistyrose"</span>,</span>
<span id="cb22-767"><a href="#cb22-767" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0"</span>             <span class="ot">=</span> <span class="st">"white"</span>,</span>
<span id="cb22-768"><a href="#cb22-768" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0 to 100"</span>      <span class="ot">=</span> <span class="st">"greenyellow"</span>,</span>
<span id="cb22-769"><a href="#cb22-769" aria-hidden="true" tabindex="-1"></a>  <span class="st">"100 to 1K"</span>     <span class="ot">=</span> <span class="st">"limegreen"</span>,</span>
<span id="cb22-770"><a href="#cb22-770" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&gt; 10K"</span>         <span class="ot">=</span> <span class="st">"darkgreen"</span></span>
<span id="cb22-771"><a href="#cb22-771" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-772"><a href="#cb22-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-773"><a href="#cb22-773" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP1_WTP_bin <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb22-774"><a href="#cb22-774" aria-hidden="true" tabindex="-1"></a>  all_df<span class="sc">$</span>SSP1_WTP_bin,</span>
<span id="cb22-775"><a href="#cb22-775" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb22-776"><a href="#cb22-776" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-777"><a href="#cb22-777" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP2_WTP_bin <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb22-778"><a href="#cb22-778" aria-hidden="true" tabindex="-1"></a>  all_df<span class="sc">$</span>SSP2_WTP_bin,</span>
<span id="cb22-779"><a href="#cb22-779" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb22-780"><a href="#cb22-780" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-781"><a href="#cb22-781" aria-hidden="true" tabindex="-1"></a>all_df<span class="sc">$</span>SSP2_WTP_bin <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb22-782"><a href="#cb22-782" aria-hidden="true" tabindex="-1"></a>  all_df<span class="sc">$</span>SSP2_WTP_bin,</span>
<span id="cb22-783"><a href="#cb22-783" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb22-784"><a href="#cb22-784" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-785"><a href="#cb22-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-786"><a href="#cb22-786" aria-hidden="true" tabindex="-1"></a><span class="co"># Then plot:</span></span>
<span id="cb22-787"><a href="#cb22-787" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2050</span>, <span class="dv">2075</span>, <span class="dv">2100</span>)),</span>
<span id="cb22-788"><a href="#cb22-788" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP1_WTP_bin)</span>
<span id="cb22-789"><a href="#cb22-789" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb22-790"><a href="#cb22-790" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-791"><a href="#cb22-791" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(</span>
<span id="cb22-792"><a href="#cb22-792" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> hawaii_counties,</span>
<span id="cb22-793"><a href="#cb22-793" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb22-794"><a href="#cb22-794" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb22-795"><a href="#cb22-795" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fl">0.4</span>,</span>
<span id="cb22-796"><a href="#cb22-796" aria-hidden="true" tabindex="-1"></a>        <span class="at">inherit.aes =</span> <span class="cn">FALSE</span></span>
<span id="cb22-797"><a href="#cb22-797" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-798"><a href="#cb22-798" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb22-799"><a href="#cb22-799" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb22-800"><a href="#cb22-800" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb22-801"><a href="#cb22-801" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb22-802"><a href="#cb22-802" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-803"><a href="#cb22-803" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb22-804"><a href="#cb22-804" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-805"><a href="#cb22-805" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Year), <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb22-806"><a href="#cb22-806" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb22-807"><a href="#cb22-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-808"><a href="#cb22-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-809"><a href="#cb22-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-810"><a href="#cb22-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-811"><a href="#cb22-811" aria-hidden="true" tabindex="-1"></a><span class="fu">## Animation Welfare</span></span>
<span id="cb22-812"><a href="#cb22-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-813"><a href="#cb22-813" aria-hidden="true" tabindex="-1"></a>These produce animations of changes in annual welfare to the year 2100</span>
<span id="cb22-814"><a href="#cb22-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-815"><a href="#cb22-815" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The code chunk runs the animation and saves the file.</span>
<span id="cb22-816"><a href="#cb22-816" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The Markdown line right after brings the GIF into the rendered output.</span>
<span id="cb22-817"><a href="#cb22-817" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Make sure the GIF file path is correct relative to the document, or specify the path if needed.</span>
<span id="cb22-818"><a href="#cb22-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-819"><a href="#cb22-819" aria-hidden="true" tabindex="-1"></a>Legend for the following animations</span>
<span id="cb22-820"><a href="#cb22-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-823"><a href="#cb22-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-824"><a href="#cb22-824" aria-hidden="true" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-825"><a href="#cb22-825" aria-hidden="true" tabindex="-1"></a>  <span class="st">"≤ -1M"</span>        <span class="ot">=</span> <span class="st">"darkred"</span>,</span>
<span id="cb22-826"><a href="#cb22-826" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1M to -100K"</span> <span class="ot">=</span> <span class="st">"brown"</span>,</span>
<span id="cb22-827"><a href="#cb22-827" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100K to -1K"</span> <span class="ot">=</span> <span class="st">"lightcoral"</span>,</span>
<span id="cb22-828"><a href="#cb22-828" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-1K to -100"</span>  <span class="ot">=</span> <span class="st">"pink"</span>,</span>
<span id="cb22-829"><a href="#cb22-829" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-100 to 0"</span>    <span class="ot">=</span> <span class="st">"mistyrose"</span>,</span>
<span id="cb22-830"><a href="#cb22-830" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0"</span>            <span class="ot">=</span> <span class="st">"white"</span>,</span>
<span id="cb22-831"><a href="#cb22-831" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0 to 100"</span>     <span class="ot">=</span> <span class="st">"greenyellow"</span>,</span>
<span id="cb22-832"><a href="#cb22-832" aria-hidden="true" tabindex="-1"></a>  <span class="st">"100 to 1K"</span>    <span class="ot">=</span> <span class="st">"limegreen"</span>,</span>
<span id="cb22-833"><a href="#cb22-833" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&gt; 10K"</span>        <span class="ot">=</span> <span class="st">"darkgreen"</span></span>
<span id="cb22-834"><a href="#cb22-834" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-835"><a href="#cb22-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-836"><a href="#cb22-836" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a blank plot canvas</span></span>
<span id="cb22-837"><a href="#cb22-837" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb22-838"><a href="#cb22-838" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span>, <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">yaxt =</span> <span class="st">"n"</span>, <span class="at">bty =</span> <span class="st">"n"</span>,</span>
<span id="cb22-839"><a href="#cb22-839" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb22-840"><a href="#cb22-840" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-841"><a href="#cb22-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-842"><a href="#cb22-842" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw the standalone legend</span></span>
<span id="cb22-843"><a href="#cb22-843" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb22-844"><a href="#cb22-844" aria-hidden="true" tabindex="-1"></a>  <span class="st">"center"</span>,</span>
<span id="cb22-845"><a href="#cb22-845" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">names</span>(color_palette),</span>
<span id="cb22-846"><a href="#cb22-846" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill   =</span> <span class="fu">unname</span>(color_palette),</span>
<span id="cb22-847"><a href="#cb22-847" aria-hidden="true" tabindex="-1"></a>  <span class="at">bty    =</span> <span class="st">"o"</span>,           <span class="co"># border around legend</span></span>
<span id="cb22-848"><a href="#cb22-848" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex    =</span> <span class="fl">1.0</span>,           <span class="co"># text size</span></span>
<span id="cb22-849"><a href="#cb22-849" aria-hidden="true" tabindex="-1"></a>  <span class="at">title  =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb22-850"><a href="#cb22-850" aria-hidden="true" tabindex="-1"></a>  <span class="at">title.cex =</span> <span class="fl">1.2</span>,        <span class="co"># title size</span></span>
<span id="cb22-851"><a href="#cb22-851" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol   =</span> <span class="dv">1</span>,</span>
<span id="cb22-852"><a href="#cb22-852" aria-hidden="true" tabindex="-1"></a>  <span class="at">xpd    =</span> <span class="cn">TRUE</span></span>
<span id="cb22-853"><a href="#cb22-853" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-854"><a href="#cb22-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-855"><a href="#cb22-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-856"><a href="#cb22-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-857"><a href="#cb22-857" aria-hidden="true" tabindex="-1"></a><span class="fu">### SSP1 </span></span>
<span id="cb22-858"><a href="#cb22-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-859"><a href="#cb22-859" aria-hidden="true" tabindex="-1"></a>2030<span class="sc">\&gt;\&gt;\&gt;\&gt;</span>2100</span>
<span id="cb22-860"><a href="#cb22-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-861"><a href="#cb22-861" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/hawaii_wtpssp1_animation.gif)</span></span>
<span id="cb22-862"><a href="#cb22-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-863"><a href="#cb22-863" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-864"><a href="#cb22-864" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb22-865"><a href="#cb22-865" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2100</span>)) <span class="sc">+</span></span>
<span id="cb22-866"><a href="#cb22-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-867"><a href="#cb22-867" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP1_WTP_bin),</span>
<span id="cb22-868"><a href="#cb22-868" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>    <span class="fu">geom_sf</span>(<span class="at">data =</span> hawaii_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb22-869"><a href="#cb22-869" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb22-870"><a href="#cb22-870" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb22-871"><a href="#cb22-871" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb22-872"><a href="#cb22-872" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb22-873"><a href="#cb22-873" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-874"><a href="#cb22-874" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb22-875"><a href="#cb22-875" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-876"><a href="#cb22-876" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb22-877"><a href="#cb22-877" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'SSP1 Year: {closest_state}'</span>)</span>
<span id="cb22-878"><a href="#cb22-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-879"><a href="#cb22-879" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb22-880"><a href="#cb22-880" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transition_states</span>(Year, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-881"><a href="#cb22-881" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ease_aes</span>(<span class="st">'cubic-in-out'</span>) <span class="sc">+</span></span>
<span id="cb22-882"><a href="#cb22-882" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shadow_wake</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">wake_length =</span> <span class="fl">0.2</span>)</span>
<span id="cb22-883"><a href="#cb22-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-884"><a href="#cb22-884" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(anim, <span class="at">nframes =</span> <span class="dv">81</span>, <span class="at">fps =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb22-885"><a href="#cb22-885" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"hawaii_wtpssp1_animation.gif"</span>, <span class="at">animation =</span> <span class="fu">last_animation</span>())</span>
<span id="cb22-886"><a href="#cb22-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-887"><a href="#cb22-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-888"><a href="#cb22-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-889"><a href="#cb22-889" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-890"><a href="#cb22-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-891"><a href="#cb22-891" aria-hidden="true" tabindex="-1"></a><span class="fu">### SSP2</span></span>
<span id="cb22-892"><a href="#cb22-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-893"><a href="#cb22-893" aria-hidden="true" tabindex="-1"></a>2030<span class="sc">\&gt;\&gt;\&gt;\&gt;</span>2100</span>
<span id="cb22-894"><a href="#cb22-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-895"><a href="#cb22-895" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/hawaii_wtpssp2_animation.gif)</span></span>
<span id="cb22-896"><a href="#cb22-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-897"><a href="#cb22-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-898"><a href="#cb22-898" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb22-899"><a href="#cb22-899" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2100</span>)) <span class="sc">+</span></span>
<span id="cb22-900"><a href="#cb22-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-901"><a href="#cb22-901" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP2_WTP_bin),</span>
<span id="cb22-902"><a href="#cb22-902" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>    <span class="fu">geom_sf</span>(<span class="at">data =</span> hawaii_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb22-903"><a href="#cb22-903" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb22-904"><a href="#cb22-904" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb22-905"><a href="#cb22-905" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb22-906"><a href="#cb22-906" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb22-907"><a href="#cb22-907" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-908"><a href="#cb22-908" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb22-909"><a href="#cb22-909" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-910"><a href="#cb22-910" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb22-911"><a href="#cb22-911" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'SSP2 Year: {closest_state}'</span>)</span>
<span id="cb22-912"><a href="#cb22-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-913"><a href="#cb22-913" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb22-914"><a href="#cb22-914" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transition_states</span>(Year, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-915"><a href="#cb22-915" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ease_aes</span>(<span class="st">'cubic-in-out'</span>) <span class="sc">+</span></span>
<span id="cb22-916"><a href="#cb22-916" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shadow_wake</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">wake_length =</span> <span class="fl">0.2</span>)</span>
<span id="cb22-917"><a href="#cb22-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-918"><a href="#cb22-918" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(anim, <span class="at">nframes =</span> <span class="dv">81</span>, <span class="at">fps =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb22-919"><a href="#cb22-919" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"hawaii_wtpssp2_animation.gif"</span>, <span class="at">animation =</span> <span class="fu">last_animation</span>())</span>
<span id="cb22-920"><a href="#cb22-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-921"><a href="#cb22-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-922"><a href="#cb22-922" aria-hidden="true" tabindex="-1"></a><span class="fu">### SSP3</span></span>
<span id="cb22-923"><a href="#cb22-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-924"><a href="#cb22-924" aria-hidden="true" tabindex="-1"></a>2030<span class="sc">\&gt;\&gt;\&gt;\&gt;</span>2100</span>
<span id="cb22-925"><a href="#cb22-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-926"><a href="#cb22-926" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/hawaii_wtpssp3_animation.gif)</span></span>
<span id="cb22-927"><a href="#cb22-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-928"><a href="#cb22-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb22-929"><a href="#cb22-929" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb22-930"><a href="#cb22-930" aria-hidden="true" tabindex="-1"></a>base_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2100</span>)) <span class="sc">+</span></span>
<span id="cb22-931"><a href="#cb22-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-932"><a href="#cb22-932" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude, <span class="at">color =</span> SSP3_WTP_bin),</span>
<span id="cb22-933"><a href="#cb22-933" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span>    <span class="fu">geom_sf</span>(<span class="at">data =</span> hawaii_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb22-934"><a href="#cb22-934" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">161</span>, <span class="sc">-</span><span class="dv">154</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">18.5</span>, <span class="fl">22.5</span>)) <span class="sc">+</span></span>
<span id="cb22-935"><a href="#cb22-935" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb22-936"><a href="#cb22-936" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> color_palette,</span>
<span id="cb22-937"><a href="#cb22-937" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">"Total WTP"</span>,</span>
<span id="cb22-938"><a href="#cb22-938" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-939"><a href="#cb22-939" aria-hidden="true" tabindex="-1"></a>        <span class="at">limits =</span> <span class="fu">names</span>(color_palette)</span>
<span id="cb22-940"><a href="#cb22-940" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-941"><a href="#cb22-941" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb22-942"><a href="#cb22-942" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'SSP3 Year: {closest_state}'</span>)</span>
<span id="cb22-943"><a href="#cb22-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-944"><a href="#cb22-944" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> base_map <span class="sc">+</span></span>
<span id="cb22-945"><a href="#cb22-945" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transition_states</span>(Year, <span class="at">transition_length =</span> <span class="dv">1</span>, <span class="at">state_length =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-946"><a href="#cb22-946" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ease_aes</span>(<span class="st">'cubic-in-out'</span>) <span class="sc">+</span></span>
<span id="cb22-947"><a href="#cb22-947" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shadow_wake</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">wake_length =</span> <span class="fl">0.2</span>)</span>
<span id="cb22-948"><a href="#cb22-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-949"><a href="#cb22-949" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(anim, <span class="at">nframes =</span> <span class="dv">81</span>, <span class="at">fps =</span> <span class="dv">10</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb22-950"><a href="#cb22-950" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"hawaii_wtpssp3_animation.gif"</span>, <span class="at">animation =</span> <span class="fu">last_animation</span>())</span>
<span id="cb22-951"><a href="#cb22-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-952"><a href="#cb22-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-953"><a href="#cb22-953" aria-hidden="true" tabindex="-1"></a><span class="fu">### </span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>